<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>data401-nlp - Lab 2 - Leveraging SpaCy for Comparative Textual EDA (Part 1)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="data401-nlp - Lab 2 - Leveraging SpaCy for Comparative Textual EDA (Part 1)">
<meta property="og:description" content="Interactive NLP course labs for Jupyter, Colab, and Deepnote">
<meta property="og:site_name" content="data401-nlp">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">data401-nlp</span>
    </a>
  </div>
        <div class="quarto-navbar-tools">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./eda_spacy.html">Lab 2 - Leveraging SpaCy for Comparative Textual EDA (Part 1)</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">README</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">00_core.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1 - Introduction to the SpaCy Pipeline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda_spacy.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Lab 2 - Leveraging SpaCy for Comparative Textual EDA (Part 1)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda_spacy_part2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2 - Leveraging spaCy for Comparative Textual EDA (Part 2)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3 Skills: Regular Expressions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./zero_frequency_compression_unigrams_bigrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Zero-Frequency Problem in Text Compression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-sentiment_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4 - Sparse vectors and Sentiment Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_helpers_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">99_helpers_test.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./platform_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Platform Compatibility Tests</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">helpers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./helpers/env.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Environment Detection helper (env.py)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./helpers/llm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LLM chat helper (llm.py)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./helpers/submit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook Submission Helper (submit.py)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./helpers/spacy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">spaCy Model Helper (spacy.py)</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-libraries-and-models" id="toc-load-libraries-and-models" class="nav-link active" data-scroll-target="#load-libraries-and-models">Load libraries and models</a></li>
  <li><a href="#introduction-to-corpus-design-and-eda" id="toc-introduction-to-corpus-design-and-eda" class="nav-link" data-scroll-target="#introduction-to-corpus-design-and-eda">Introduction to Corpus Design and EDA</a>
  <ul>
  <li><a href="#the-purpose-of-eda" id="toc-the-purpose-of-eda" class="nav-link" data-scroll-target="#the-purpose-of-eda">The Purpose of EDA</a></li>
  <li><a href="#questions-to-kick-off-eda" id="toc-questions-to-kick-off-eda" class="nav-link" data-scroll-target="#questions-to-kick-off-eda">Questions to Kick-off EDA</a></li>
  </ul></li>
  <li><a href="#quick-refresher" id="toc-quick-refresher" class="nav-link" data-scroll-target="#quick-refresher">Quick Refresher</a></li>
  <li><a href="#corpus-level-overview" id="toc-corpus-level-overview" class="nav-link" data-scroll-target="#corpus-level-overview">Corpus-Level Overview</a>
  <ul>
  <li><a href="#dataset-description" id="toc-dataset-description" class="nav-link" data-scroll-target="#dataset-description">Dataset Description</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  </ul></li>
  <li><a href="#a---token-level-distributions" id="toc-a---token-level-distributions" class="nav-link" data-scroll-target="#a---token-level-distributions">A - Token-Level Distributions</a>
  <ul>
  <li><a href="#modify-tokenization" id="toc-modify-tokenization" class="nav-link" data-scroll-target="#modify-tokenization">Modify tokenization</a></li>
  <li><a href="#gather-some-statistics" id="toc-gather-some-statistics" class="nav-link" data-scroll-target="#gather-some-statistics">Gather some statistics</a></li>
  <li><a href="#hashtags" id="toc-hashtags" class="nav-link" data-scroll-target="#hashtags">Hashtags</a></li>
  <li><a href="#emojis" id="toc-emojis" class="nav-link" data-scroll-target="#emojis">Emojis</a></li>
  <li><a href="#section-a-summary-token-level-distributions" id="toc-section-a-summary-token-level-distributions" class="nav-link" data-scroll-target="#section-a-summary-token-level-distributions">Section A Summary: Token-Level Distributions</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection">Reflection</a></li>
  </ul></li>
  <li><a href="#b---visualize" id="toc-b---visualize" class="nav-link" data-scroll-target="#b---visualize">B - Visualize</a>
  <ul>
  <li><a href="#document-length-distribution" id="toc-document-length-distribution" class="nav-link" data-scroll-target="#document-length-distribution">Document length distribution</a></li>
  <li><a href="#keyword-in-context" id="toc-keyword-in-context" class="nav-link" data-scroll-target="#keyword-in-context">Keyword-in-Context</a></li>
  <li><a href="#reflection-1" id="toc-reflection-1" class="nav-link" data-scroll-target="#reflection-1">Reflection</a></li>
  </ul></li>
  <li><a href="#c---distributional-patterns" id="toc-c---distributional-patterns" class="nav-link" data-scroll-target="#c---distributional-patterns">C - Distributional Patterns</a>
  <ul>
  <li><a href="#reflection-2" id="toc-reflection-2" class="nav-link" data-scroll-target="#reflection-2">Reflection</a></li>
  </ul></li>
  <li><a href="#d---lexical-variety-through-lemmatization" id="toc-d---lexical-variety-through-lemmatization" class="nav-link" data-scroll-target="#d---lexical-variety-through-lemmatization">D - Lexical Variety Through Lemmatization</a></li>
  <li><a href="#reflection-3" id="toc-reflection-3" class="nav-link" data-scroll-target="#reflection-3">Reflection</a></li>
  <li><a href="#notebook-summary" id="toc-notebook-summary" class="nav-link" data-scroll-target="#notebook-summary">Notebook Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/su-dataAI/data401-nlp/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 2 - Leveraging SpaCy for Comparative Textual EDA (Part 1)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p>In the last lab you learned about: - spaCy’s Doc object structure - Token attributes (text, pos_, lemma_, is_stop, is_punct) - Using the spaCy pipeline for tokenization, lemmatization, POS tagging, Parsing, and NER - Iterating over tokens to extract linguistic features - Exploring differences between classical NLP methods and LLM-based methods</p>
<p><strong>Learning objectives this week:</strong></p>
<ul>
<li><strong>Conduct a small comparative corpus analysis</strong>, recognizing how sampling decisions, labeling, and preprocessing choices affect downstream analysis.</li>
<li><strong>Apply spaCy to exploratory text analysis</strong>, using token and word counts.</li>
<li><strong>Use frequency, normalization, and dispersion</strong> to compare language use across groups, and explain why raw counts are often misleading.</li>
<li><strong>Interpret lexical variety through lemmatization</strong>, including calculating and reasoning about lemma–token ratios and shared vs.&nbsp;group-specific vocabulary.</li>
</ul>
<p><strong>Useful References:</strong></p>
<ul>
<li>SpaCy API. https://spacy.io/api</li>
<li>Jurafsky and Martin, <a href="https://web.stanford.edu/~jurafsky/slp3/2.pdf">Chapter 2</a>: Words and Tokens</li>
</ul>
<p>We’re speeding ahead into EDA early because your mid-term project will be EDA. This lab and the next are rather long and go into much more depth than necessary for that assignment. However, it will help you to start thinking about this earlier, rather than later.</p>
<div id="2ccf4b23-f946-4f1c-9fab-fc107fad12d6" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you are colab, un-comment the pip install below.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This will not be necessary on DeepNote or your local installation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install data401_nlp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="load-libraries-and-models" class="level2">
<h2 class="anchored" data-anchor-id="load-libraries-and-models">Load libraries and models</h2>
<div id="4ce5e88f" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Environment (must run first)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> data401_nlp</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data401_nlp.__version__)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Core libs</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> spacy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0.6
0.0.6
0.0.7</code></pre>
</div>
</div>
<div id="3c973212-42e8-4a50-b159-e97805e05854" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This checks to make sure your SUBMIT_API_KEY is present</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It can take a moment to load... run again if it fails the first time</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"SUBMIT_API_KEY present:"</span>, <span class="bu">bool</span>(os.getenv(<span class="st">"SUBMIT_API_KEY"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Detected environment: dotenv
SUBMIT_API_KEY present: True</code></pre>
</div>
</div>
</section>
<section id="introduction-to-corpus-design-and-eda" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-corpus-design-and-eda">Introduction to Corpus Design and EDA</h2>
<p>In traditional corpus linguistics, the word <strong>corpus</strong> refers to a sample of language data that strives to be representative of a particular language variety. <strong>Language variety</strong> is a general term for language that shares one or more common traits, such as dialect, genre, or topic.</p>
<p>In this week’s classroom activity, you will examine corpora designed to study distributional properties of language. Such corpora are sampled with careful tracking of demographic and linguistic representativeness. They are also labeled with high-quality annotations to capture linguistic features of interest. This sampling and annotation allows for reproducible, high-confidence analyses.</p>
<p>That said, designed corpora come with a great amount of exploratory data analysis already included in metadata. For example, often included are descriptive statistics such as number of sentences, words, etc. Thus today, you will do EDA with basic statistics and analysis using spaCy.</p>
<p>Next week you will use NLP techniques such as parsing, pattern recognition, and named entity recognition to infer labels and describe and compare two sets of related data. What you won’t do at this point is assess the accuracy of your labeling.</p>
<section id="the-purpose-of-eda" class="level3">
<h3 class="anchored" data-anchor-id="the-purpose-of-eda">The Purpose of EDA</h3>
<p><strong>Exploratory Data Analysis (EDA)</strong> is the process of examining and summarizing datasets to understand their main characteristics before applying formal modeling or hypothesis testing. For text data, EDA involves understanding vocabulary, document lengths, word distributions, and linguistic patterns.</p>
<p>Data collection and analysis serve one goal: answering questions with data. With that in mind, EDA serves a few purposes: 1. Ensure <strong>representativeness</strong> of the population or phenomenon under consideration - to make sure that the phenomena you seek are present in the data - to identify and account for outliers or other anomalies 2. Reveal <strong>characteristics of data</strong> that might affect the <strong>generalizability</strong> or <strong>validity</strong> of your analysis 3. Provide insight into <strong>features</strong> that can be helpful in answering your data analytic questions</p>
</section>
<section id="questions-to-kick-off-eda" class="level3">
<h3 class="anchored" data-anchor-id="questions-to-kick-off-eda">Questions to Kick-off EDA</h3>
<p>You can start an EDA by asking some fundamental questions, such as: - How can I make sure my data is <strong>representative</strong> of the people or phenomena I want to describe? - Do I have <strong>enough data</strong>? - e.g., if using a sentiment lexicon, do the words in the lexicon appear often enough to provide a basis for analysis - What is the <strong>structure of my data</strong>? - threaded conversation-like discourse with identifiable speakers - Do I have enough information about the speakers to generalize about them? - Do I have enough text per speaker? - news articles that all start with a summary of new information - academic literature with a keyword list and abstract - sports reports where I might find tables with statistics - What <strong>metadata</strong> is available? - user profiles with demographic information - topic lists - hashtags that might act like topic or discourse labels - What <strong>useful features can be derived</strong> from the data? - would grouping the data into topics make sense? - do I need to extract person names or <span class="citation" data-cites="mentions">@mentions</span> to answer the question at hand?</p>
</section>
</section>
<section id="quick-refresher" class="level2">
<h2 class="anchored" data-anchor-id="quick-refresher">Quick Refresher</h2>
<p>Let’s load our dataset into doc objects</p>
<div id="cc616903" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> data401_nlp.helpers.spacy <span class="im">import</span> ensure_spacy_model</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_nlp():</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ensure_spacy_model(<span class="st">"en_core_web_sm"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>nlp <span class="op">=</span> get_nlp()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.read_csv(<span class="st">"data/covidisreal_OR_wearamask_hashtag.csv"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.read_csv(<span class="st">"data/covidhoax_OR_notomasks_hashtag.csv"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">'group'</span>] <span class="op">=</span> <span class="st">'promask'</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'group'</span>] <span class="op">=</span> <span class="st">'antimask'</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([df1, df2], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'group'</span>).head(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ spaCy model 'en_core_web_sm' loaded successfully</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">created_date</th>
<th data-quarto-table-cell-role="th">hashtags</th>
<th data-quarto-table-cell-role="th">num_hashtags</th>
<th data-quarto-table-cell-role="th">tweet_length</th>
<th data-quarto-table-cell-role="th">tweet_text</th>
<th data-quarto-table-cell-role="th">group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2020-08-31 02:08:31</td>
<td>2020sucks trumpisscar ihateithere wearamask</td>
<td>4</td>
<td>90</td>
<td>#2020sucks #trumpisscar #ihateithere #wearamas...</td>
<td>promask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2020-08-31 02:07:58</td>
<td>antimasker antimasking DOJ pandemic</td>
<td>4</td>
<td>137</td>
<td>This is probably one of the most ridiculous of...</td>
<td>promask</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2020-08-31 02:07:28</td>
<td>wearamask maskuphoosiers</td>
<td>2</td>
<td>69</td>
<td>Just, like, do it. #wearamask #maskuphoosiers ...</td>
<td>promask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2020-08-31 02:07:16</td>
<td>NaN</td>
<td>0</td>
<td>140</td>
<td>So one day a guy will be bragging how he didn’...</td>
<td>promask</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5000</td>
<td>2020-08-31 02:03:58</td>
<td>COVID19 covidhoax</td>
<td>2</td>
<td>125</td>
<td>6% Of all #COVID19 Deaths were from just the v...</td>
<td>antimask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5001</td>
<td>2020-08-31 02:03:35</td>
<td>COVID19</td>
<td>1</td>
<td>140</td>
<td>#COVID19 is a hoax. Fuck masks. If you don’t ...</td>
<td>antimask</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5002</td>
<td>2020-08-31 02:02:55</td>
<td>COVID19 CovidHoax</td>
<td>2</td>
<td>148</td>
<td>@ProfPCDoherty There was no need to shut the b...</td>
<td>antimask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5003</td>
<td>2020-08-31 02:01:45</td>
<td>CovidHoax</td>
<td>1</td>
<td>140</td>
<td>#CovidHoax is over... Let's OPEN the world and...</td>
<td>antimask</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>In Lab 1, we processed individual sentences. Today: what happens when we process thousands of tweets and compare patterns across two communities?</p>
</section>
<section id="corpus-level-overview" class="level2">
<h2 class="anchored" data-anchor-id="corpus-level-overview">Corpus-Level Overview</h2>
<section id="dataset-description" class="level3">
<h3 class="anchored" data-anchor-id="dataset-description">Dataset Description</h3>
</section>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>Our goal for this lab is to do exploratory data analysis on a collection from Twitter.</p>
<p>Your dataset is comprised of two CSV files. They were both collected in 2020 using <a href="https://www.tweepy.org/">Tweepy</a>, a Python library for accessing Twitter’s API. Two searches were conducted, with a maximum number of English language tweets of 5000, and with retweets filtered out during collection.</p>
<p>Hashtags used for search were: 1. #covidhoax OR #notomask 2. #covidisreal OR #wearamask</p>
<p>This collection was created specifically for students of NLP in a prior semester. The data is not representative of any population and is not intended for publication or re-distribution.</p>
<p>We will explore and describe this dataset using descriptive statistics first. Then we will compare the two collections using other spaCy capabilities.</p>
<p>Please do not share or post these CSV files. Despite changes in Twitter ownership, they come with licensing restrictions. In the past, I had students collect this data individually. Since that’s no longer an easy option, you will use pre-collected data. The <a href="https://github.com/KatherineMichel/stanford-code-in-place-final-project/blob/master/twitter-developer-agreement-march-10.md">licensing restriction applicable to the 2020 collection is documented here</a>.</p>
<blockquote class="blockquote">
<p>You may not “sell, rent, lease, sublicense, distribute, redistribute, syndicate… or otherwise transfer or provide access to… the Licensed Material to any third party except as expressly permitted,” which means you should not give students a large raw dump designed to let them avoid having their own relationship with the API.</p>
</blockquote>
<blockquote class="blockquote">
<p>In practice, for a small academic exercise: it is acceptable to share a modest tweet subset with students inside your course context, provided it is non‑commercial, secured, not a bulk replacement for the API, and you honor deletion/visibility changes and the privacy and usage rules in the Developer Policy.</p>
</blockquote>
</section>
</section>
<section id="a---token-level-distributions" class="level2">
<h2 class="anchored" data-anchor-id="a---token-level-distributions">A - Token-Level Distributions</h2>
<p>We’ll start with basic descriptive statistics. In particular, we’re interested in:</p>
<ul>
<li>hashtag counts</li>
<li>token counts</li>
<li>word length</li>
<li>tweets (documents)</li>
<li>and tweet (document) length.</li>
</ul>
<p>Let’s take a step back and think about what we are counting when we talk about tokens.</p>
<p>We already know <strong>tokens</strong> are a basic unit of processing—individual instances of words, punctuation, or other text elements as they appear in a document. A <strong>type</strong> is a distinct word form; it represents the unique vocabulary item regardless of how many times it appears. In fact, we often think of words as canonical tokens.</p>
<blockquote class="blockquote">
<p><strong>Key distinction:</strong> If a document contains “the cat and the dog,” it has 5 tokens but only 4 types (since “the” appears twice).</p>
</blockquote>
<p>From <a href="https://spacy.io/api/lexeme">spaCy documentation</a>:</p>
<ul>
<li>In spaCy, a <strong>lexeme</strong> is a <em>vocabulary entry</em> keyed by the hash of a string form (ORTH), representing a word type (form) with context‑independent attributes like casing, shape, and optional vector, but no token-level context such as POS or dependency.</li>
<li>In spaCy, <strong>a lexeme is “a word type, as opposed to a word token,”</strong> stored in Vocab and shared by all tokens with the same ORTH (string hash).</li>
<li>spaCy maintains a StringStore mapping each distinct string to a unique integer ID; the same ID (ORTH) is used to index a Lexeme in Vocab.</li>
<li>When a new string appears (e.g., during tokenization or when you access nlp.vocab[“word”]), spaCy creates or retrieves the corresponding lexeme keyed by that ORTH value.</li>
</ul>
<p>While there are lots of ways to think about vocabulary and count things, you should always be careful to explain how you counted. In the function below, we are counting objects that: - have already been pre-processed - are lower-cased - are not whitespace characters.</p>
<p><strong><code>get_vocab()</code></strong> (below) is a function builds a vocabulary set by iterating through all texts, processing each through spaCy’s pipeline, extracting each token’s lowercase text, and filtering out whitespace. The result is the set of unique word forms (types) in the corpus.</p>
<div id="38946400" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_vocab(texts, nlp):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Return set of unique lowercased token strings from texts."""</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(texts, <span class="st">"tolist"</span>):</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        texts <span class="op">=</span> texts.tolist()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        tok.text.lower()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> doc <span class="kw">in</span> nlp.pipe((t <span class="cf">for</span> t <span class="kw">in</span> texts <span class="cf">if</span> <span class="bu">isinstance</span>(t, <span class="bu">str</span>)))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tok <span class="kw">in</span> doc</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> tok.is_space</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>nlp <span class="op">=</span> get_nlp()  <span class="co"># if you want this cell to be standalone</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>promask_vocab <span class="op">=</span> get_vocab(df.loc[df.group <span class="op">==</span> <span class="st">"promask"</span>, <span class="st">"tweet_text"</span>], nlp)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>antimask_vocab <span class="op">=</span> get_vocab(df.loc[df.group <span class="op">==</span> <span class="st">"antimask"</span>, <span class="st">"tweet_text"</span>], nlp)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>combined_vocab <span class="op">=</span> promask_vocab <span class="op">|</span> antimask_vocab</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="bu">dict</span>(</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    promask<span class="op">=</span><span class="bu">len</span>(promask_vocab),</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    antimask<span class="op">=</span><span class="bu">len</span>(antimask_vocab),</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    combined<span class="op">=</span><span class="bu">len</span>(combined_vocab),</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    shared<span class="op">=</span><span class="bu">len</span>(promask_vocab <span class="op">&amp;</span> antimask_vocab),</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ spaCy model 'en_core_web_sm' loaded successfully</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>{'promask': 17753, 'antimask': 8293, 'combined': 22939, 'shared': 3107}</code></pre>
</div>
</div>
<p><strong><code>compute_token_counts():</code></strong> counts the number of tokens in each document by processing texts through spaCy and returning the length of each resulting Doc object.</p>
<div id="c645a607" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_token_counts(texts):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    nlp <span class="op">=</span> get_nlp()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(texts, <span class="st">"tolist"</span>):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        texts <span class="op">=</span> texts.tolist()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">len</span>(doc)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> doc <span class="kw">in</span> nlp.pipe((t <span class="cf">for</span> t <span class="kw">in</span> texts <span class="cf">if</span> <span class="bu">isinstance</span>(t, <span class="bu">str</span>)))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"token_count"</span>] <span class="op">=</span> compute_token_counts(df[<span class="st">"tweet_text"</span>])</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"token_count"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ spaCy model 'en_core_web_sm' loaded successfully</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>0       13
1       23
2       12
3       29
4       25
        ..
7064    31
7065    23
7066    22
7067    28
7068    24
Name: token_count, Length: 7069, dtype: int64</code></pre>
</div>
</div>
<p>Let’s check for missing data.</p>
<div id="3e19d1de" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>missing <span class="op">=</span> df[[<span class="st">'created_date'</span>, <span class="st">'hashtags'</span>, <span class="st">'num_hashtags'</span>, <span class="st">'tweet_length'</span>, <span class="st">'tweet_text'</span>, <span class="st">'group'</span>]].isnull().<span class="bu">sum</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>missing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>created_date       0
hashtags        2419
num_hashtags       0
tweet_length       0
tweet_text         0
group              0
dtype: int64</code></pre>
</div>
</div>
<p>We might not care if hashtags are missing, though it is interesting that such a large number of tweets don’t contain them. What do you think the absense of hashtags might indicate?</p>
<div id="540cf3b2" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df[df.duplicated(subset<span class="op">=</span><span class="st">'tweet_text'</span>, keep<span class="op">=</span><span class="va">False</span>)].sort_values(<span class="st">'tweet_text'</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">created_date</th>
<th data-quarto-table-cell-role="th">hashtags</th>
<th data-quarto-table-cell-role="th">num_hashtags</th>
<th data-quarto-table-cell-role="th">tweet_length</th>
<th data-quarto-table-cell-role="th">tweet_text</th>
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">token_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5759</td>
<td>2020-08-27 19:36:10</td>
<td>COVID CovidHoax</td>
<td>2</td>
<td>121</td>
<td>@cangal21 Forced quarantine camps now operatin...</td>
<td>antimask</td>
<td>22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5756</td>
<td>2020-08-27 19:37:56</td>
<td>COVID CovidHoax</td>
<td>2</td>
<td>121</td>
<td>@cangal21 Forced quarantine camps now operatin...</td>
<td>antimask</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5489</td>
<td>2020-08-29 04:32:47</td>
<td>masksavelives wearamask masksoff</td>
<td>3</td>
<td>138</td>
<td>@jadedcreative Yes everyone please virtue-sign...</td>
<td>antimask</td>
<td>28</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3532</td>
<td>2020-08-29 04:32:47</td>
<td>masksavelives wearamask masksoff</td>
<td>3</td>
<td>138</td>
<td>@jadedcreative Yes everyone please virtue-sign...</td>
<td>promask</td>
<td>28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5484</td>
<td>2020-08-29 05:48:42</td>
<td>NaN</td>
<td>0</td>
<td>140</td>
<td>@letseathh @BBCNews Can you please explain to ...</td>
<td>antimask</td>
<td>24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3476</td>
<td>2020-08-29 05:48:42</td>
<td>NaN</td>
<td>0</td>
<td>140</td>
<td>@letseathh @BBCNews Can you please explain to ...</td>
<td>promask</td>
<td>24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5488</td>
<td>2020-08-29 04:42:07</td>
<td>masksavelives wearamask masksoff covid coronav...</td>
<td>5</td>
<td>136</td>
<td>@markpoloncarz VIRTUE-SIGNALING DOES NOT SAVE ...</td>
<td>antimask</td>
<td>24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3528</td>
<td>2020-08-29 04:42:07</td>
<td>masksavelives wearamask masksoff covid coronav...</td>
<td>5</td>
<td>136</td>
<td>@markpoloncarz VIRTUE-SIGNALING DOES NOT SAVE ...</td>
<td>promask</td>
<td>24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5768</td>
<td>2020-08-27 19:32:30</td>
<td>COVID CovidHoax</td>
<td>2</td>
<td>127</td>
<td>@roccogalatilaw Forced quarantine camps now op...</td>
<td>antimask</td>
<td>22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5762</td>
<td>2020-08-27 19:35:14</td>
<td>COVID CovidHoax</td>
<td>2</td>
<td>127</td>
<td>@roccogalatilaw Forced quarantine camps now op...</td>
<td>antimask</td>
<td>22</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="c63243ec" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>n_duplicates <span class="op">=</span> df.duplicated(subset<span class="op">=</span><span class="st">'tweet_text'</span>).<span class="bu">sum</span>()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>n_duplicates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>np.int64(17)</code></pre>
</div>
</div>
<p>Based on the duplicate examples shown, some may be tweets that matched both search queries (e.g., a tweet containing both #wearamask and #covidhoax hashtags). Since the two CSV files were collected separately using different hashtag searches, the same tweet could appear in both collections.</p>
<p>Let’s start looking at tokens! Let’s add a column that shows us tokenization with a simple split function. Recall that <strong>spaCy’s tokenizer handles punctuation, contractions, URLs, etc. as separate tokens, while split() just breaks on spaces</strong>. Let’s compare these two approaches with our data.</p>
<div id="57262cd0" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_split_counts(texts):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(texts, <span class="st">"tolist"</span>):</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        texts <span class="op">=</span> texts.tolist()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="bu">len</span>(t.split()) <span class="cf">if</span> <span class="bu">isinstance</span>(t, <span class="bu">str</span>) <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> t <span class="kw">in</span> texts]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"split_count"</span>] <span class="op">=</span> compute_split_counts(df[<span class="st">"tweet_text"</span>])</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"group"</span>).head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">created_date</th>
<th data-quarto-table-cell-role="th">hashtags</th>
<th data-quarto-table-cell-role="th">num_hashtags</th>
<th data-quarto-table-cell-role="th">tweet_length</th>
<th data-quarto-table-cell-role="th">tweet_text</th>
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">token_count</th>
<th data-quarto-table-cell-role="th">split_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2020-08-31 02:08:31</td>
<td>2020sucks trumpisscar ihateithere wearamask</td>
<td>4</td>
<td>90</td>
<td>#2020sucks #trumpisscar #ihateithere #wearamas...</td>
<td>promask</td>
<td>13</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2020-08-31 02:07:58</td>
<td>antimasker antimasking DOJ pandemic</td>
<td>4</td>
<td>137</td>
<td>This is probably one of the most ridiculous of...</td>
<td>promask</td>
<td>23</td>
<td>18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2020-08-31 02:07:28</td>
<td>wearamask maskuphoosiers</td>
<td>2</td>
<td>69</td>
<td>Just, like, do it. #wearamask #maskuphoosiers ...</td>
<td>promask</td>
<td>12</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5000</td>
<td>2020-08-31 02:03:58</td>
<td>COVID19 covidhoax</td>
<td>2</td>
<td>125</td>
<td>6% Of all #COVID19 Deaths were from just the v...</td>
<td>antimask</td>
<td>30</td>
<td>23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5001</td>
<td>2020-08-31 02:03:35</td>
<td>COVID19</td>
<td>1</td>
<td>140</td>
<td>#COVID19 is a hoax. Fuck masks. If you don’t ...</td>
<td>antimask</td>
<td>34</td>
<td>25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5002</td>
<td>2020-08-31 02:02:55</td>
<td>COVID19 CovidHoax</td>
<td>2</td>
<td>148</td>
<td>@ProfPCDoherty There was no need to shut the b...</td>
<td>antimask</td>
<td>31</td>
<td>23</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Let’s grab one of these datasets and compare split() with spaCy tokenization by eyeballing a few tweets.</p>
<div id="c0a43061" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>nlp <span class="op">=</span> get_nlp()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> df[<span class="st">"tweet_text"</span>].iloc[i]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    doc <span class="op">=</span> nlp(text)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Tweet </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  split(): </span><span class="sc">{</span>text<span class="sc">.</span>split()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  spaCy: </span><span class="sc">{</span>[tok.text <span class="cf">for</span> tok <span class="kw">in</span> doc]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ spaCy model 'en_core_web_sm' loaded successfully
Tweet 0:
  split(): ['#2020sucks', '#trumpisscar', '#ihateithere', '#wearamask', '@', 'Black', 'In', 'America', 'https://t.co/0xJHTodSHO']
  spaCy: ['#', '2020sucks', '#', 'trumpisscar', '#', 'ihateithere', '#', 'wearamask', '@', 'Black', 'In', 'America', 'https://t.co/0xJHTodSHO']

Tweet 1:
  split(): ['This', 'is', 'probably', 'one', 'of', 'the', 'most', 'ridiculous', 'of', 'all', '#antimasker', '#antimasking', 'excuses', 'ever', 'recorded', '#DOJ', '#pandemic…', 'https://t.co/LQ53BRJVfI']
  spaCy: ['This', 'is', 'probably', 'one', 'of', 'the', 'most', 'ridiculous', 'of', 'all', '#', 'antimasker', '#', 'antimasking', 'excuses', 'ever', 'recorded', '#', 'DOJ', '#', 'pandemic', '…', 'https://t.co/LQ53BRJVfI']

Tweet 2:
  split(): ['Just,', 'like,', 'do', 'it.', '#wearamask', '#maskuphoosiers', 'https://t.co/uaVHCyWnu2']
  spaCy: ['Just', ',', 'like', ',', 'do', 'it', '.', '#', 'wearamask', '#', 'maskuphoosiers', 'https://t.co/uaVHCyWnu2']
</code></pre>
</div>
</div>
<p>Aaack! We want to keep our hashtags together! We need to look more carefully to see what else might be a problem.</p>
<p>Here’s a fake tweet with a variety of text processing issues.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>test_tweet <span class="op">=</span> <span class="st">"OMG @DrFauci said #WearAMask!!! 😷🔥 But my café au lait ☕ costs $3.50... Can't breathe w/ masks 🙄 #COVID19 #NoToMasks https://t.co/fake123 RT: </span><span class="ch">\"</span><span class="st">stay safe</span><span class="ch">\"</span><span class="st"> 👏👏👏 naïve ppl don't get it 😤"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This includes: - <span class="citation" data-cites="mentions">@mentions</span> and #hashtags - Emoji (😷🔥☕🙄😤👏) - Accented characters (café, naïve) - Punctuation clusters (!!!, …) - Contractions (Can’t) - Currency ($3.50) - URLs - Quoted text - Abbreviations (RT, OMG, ppl, w/)</p>
<p>Try running it through spaCy and <code>split()</code> to see how each handles these!</p>
<div id="589bda72" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>test_tweet <span class="op">=</span> <span class="st">"OMG @DrFauci said #WearAMask!!! 😷🔥 But my café au lait ☕ costs $3.50... Can't breathe w/ masks 🙄 #COVID19 #NoToMasks https://t.co/fake123 RT: </span><span class="ch">\"</span><span class="st">stay safe</span><span class="ch">\"</span><span class="st"> 👏👏👏 naïve ppl don't get it 😤"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7f68f57f" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>test_tweet.split()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['OMG',
 '@DrFauci',
 'said',
 '#WearAMask!!!',
 '😷🔥',
 'But',
 'my',
 'café',
 'au',
 'lait',
 '☕',
 'costs',
 '$3.50...',
 "Can't",
 'breathe',
 'w/',
 'masks',
 '🙄',
 '#COVID19',
 '#NoToMasks',
 'https://t.co/fake123',
 'RT:',
 '"stay',
 'safe"',
 '👏👏👏',
 'naïve',
 'ppl',
 "don't",
 'get',
 'it',
 '😤']</code></pre>
</div>
</div>
<div id="e518ec34" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>nlp <span class="op">=</span> get_nlp()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>test_doc <span class="op">=</span> nlp(test_tweet)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>[word.text <span class="cf">for</span> word <span class="kw">in</span> test_doc]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ spaCy model 'en_core_web_sm' loaded successfully</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>['OMG',
 '@DrFauci',
 'said',
 '#',
 'WearAMask',
 '!',
 '!',
 '!',
 '😷',
 '🔥',
 'But',
 'my',
 'café',
 'au',
 'lait',
 '☕',
 'costs',
 '$',
 '3.50',
 '...',
 'Ca',
 "n't",
 'breathe',
 'w/',
 'masks',
 '🙄',
 '#',
 'COVID19',
 '#',
 'NoToMasks',
 'https://t.co/fake123',
 'RT',
 ':',
 '"',
 'stay',
 'safe',
 '"',
 '👏',
 '👏',
 '👏',
 'naïve',
 'ppl',
 'do',
 "n't",
 'get',
 'it',
 '😤']</code></pre>
</div>
</div>
<p>Look through these carefully. What do you see beyond hashtags?</p>
<p>Here are some ideas for examining differences in tokenization:</p>
<ol type="1">
<li><p><strong>Systematic comparison</strong> — Find all tweets where <code>split()</code> and spaCy token counts differ significantly, then examine those cases</p></li>
<li><p><strong>Use spaCy’s token attributes</strong> — Check <code>token.is_punct</code>, <code>token.like_url</code>, <code>token.like_num</code>, etc. to see how spaCy is classifying things</p></li>
<li><p><strong>Look at the spaCy docs</strong> — They document known tokenization behaviors and special cases</p></li>
<li><p><strong>Sample randomly</strong> — Instead of crafting a test tweet, grab random real tweets and inspect them</p></li>
</ol>
<p>Let’s pick the data-driven approach to look at documents that vary dramatically in token counts.</p>
<div id="7c64960a" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>required_cols <span class="op">=</span> {<span class="st">"token_count"</span>, <span class="st">"split_count"</span>}</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>missing <span class="op">=</span> required_cols <span class="op">-</span> <span class="bu">set</span>(df.columns)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> missing:</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Missing required columns: </span><span class="sc">{</span>missing<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"token_diff"</span>] <span class="op">=</span> df[<span class="st">"token_count"</span>] <span class="op">-</span> df[<span class="st">"split_count"</span>]</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>df.sort_values(<span class="st">"token_diff"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">created_date</th>
<th data-quarto-table-cell-role="th">hashtags</th>
<th data-quarto-table-cell-role="th">num_hashtags</th>
<th data-quarto-table-cell-role="th">tweet_length</th>
<th data-quarto-table-cell-role="th">tweet_text</th>
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">token_count</th>
<th data-quarto-table-cell-role="th">split_count</th>
<th data-quarto-table-cell-role="th">token_diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">498</td>
<td>2020-08-30 20:44:33</td>
<td>starwars darthvader vader mask helmet</td>
<td>5</td>
<td>140</td>
<td>Dude... just wear a mask\n.\n.\n.\n___________...</td>
<td>promask</td>
<td>67</td>
<td>15</td>
<td>52</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1985</td>
<td>2020-08-29 23:42:00</td>
<td>wearamask mask safe health healthy behappy fac...</td>
<td>8</td>
<td>140</td>
<td>Ladies ❤️👱‍♀️👩🏽‍🦰👩🏿‍🦰👩‍🦱👩‍🦳👩👩🏾❤️\n\n❤️😷🙏😷❤️\n#...</td>
<td>promask</td>
<td>51</td>
<td>12</td>
<td>39</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4702</td>
<td>2020-08-28 17:21:14</td>
<td>NaN</td>
<td>0</td>
<td>140</td>
<td>My daily internal monologue: \n\n...it-goes-ov...</td>
<td>promask</td>
<td>44</td>
<td>6</td>
<td>38</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4063</td>
<td>2020-08-28 22:36:46</td>
<td>WearAMask CutenessOverload doubleshotoflove</td>
<td>3</td>
<td>131</td>
<td>🐱⛱☀️⛱☀️🐱☀️⛱☀️⛱🐱\n⛱Double Weekend Cuteness⛱\n🐱⛱...</td>
<td>promask</td>
<td>47</td>
<td>9</td>
<td>38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">975</td>
<td>2020-08-30 16:01:10</td>
<td>NaN</td>
<td>0</td>
<td>129</td>
<td>IT’S NATIONAL BEACH DAY!!!🌊\nHave sun, have fu...</td>
<td>promask</td>
<td>52</td>
<td>16</td>
<td>36</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6700</td>
<td>2020-08-23 18:49:14</td>
<td>trump IvankaTrumpCoffins jina maga kag aAynOB1...</td>
<td>8</td>
<td>138</td>
<td>#trump 🤡🎈🇷🇺🍑🍑🤦🤦‍♂️🌴🥥 \n#IvankaTrumpCoffins⚰️⚰️...</td>
<td>antimask</td>
<td>44</td>
<td>13</td>
<td>31</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4684</td>
<td>2020-08-28 17:27:30</td>
<td>NaN</td>
<td>0</td>
<td>134</td>
<td>"How Many😷😷😷Masks Can Ya Count in Last Night’s...</td>
<td>promask</td>
<td>38</td>
<td>14</td>
<td>24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2868</td>
<td>2020-08-29 15:26:32</td>
<td>playlist QuarantineLife WearAMask</td>
<td>3</td>
<td>129</td>
<td>Laleh - Some Die Young 🕊🕊🕊\n https://t.co/CJn...</td>
<td>promask</td>
<td>37</td>
<td>15</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1021</td>
<td>2020-08-30 15:41:19</td>
<td>wearamaskchallenge WearAMask TrumpsAmerica</td>
<td>3</td>
<td>114</td>
<td>Another Trump MAGAt. 🙄M~E~L~T~D~O~W~N #wearama...</td>
<td>promask</td>
<td>32</td>
<td>10</td>
<td>22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6792</td>
<td>2020-08-23 12:46:45</td>
<td>CovidHoax scamdemic</td>
<td>2</td>
<td>108</td>
<td>Have you heard this?? "we're all gonna die" LM...</td>
<td>antimask</td>
<td>34</td>
<td>12</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>2020-08-31 01:58:31</td>
<td>WearAMask VMAs</td>
<td>2</td>
<td>117</td>
<td>“#WearAMask😷. It’s a sign of respect.”\n-@lady...</td>
<td>promask</td>
<td>36</td>
<td>15</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1504</td>
<td>2020-08-30 09:59:31</td>
<td>COVID19Pandemic USA India Brazil Mexico</td>
<td>5</td>
<td>140</td>
<td>#COVID19Pandemic Top 8 death worse hit countri...</td>
<td>promask</td>
<td>38</td>
<td>17</td>
<td>21</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5285</td>
<td>2020-08-30 02:22:45</td>
<td>DictatorDan PoliceState DanLiedPeopleDied DanM...</td>
<td>6</td>
<td>140</td>
<td>#DictatorDan \n#PoliceState \n#DanLiedPeopleDi...</td>
<td>antimask</td>
<td>32</td>
<td>11</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4720</td>
<td>2020-08-28 17:10:27</td>
<td>BTSARMY MaskUpWithJK WearAMask BTS JUNGKOOK VMAs</td>
<td>6</td>
<td>119</td>
<td>I propose a new #BTSARMY hashtag! #MaskUpWithJ...</td>
<td>promask</td>
<td>34</td>
<td>13</td>
<td>21</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1345</td>
<td>2020-08-30 12:29:47</td>
<td>HairyBaby WearAMask</td>
<td>2</td>
<td>130</td>
<td>👇🏻👇🏻👇🏻👇🏻👇🏻👇🏻👇🏻👇🏻👇🏻THIS THOUGH #HairyBaby #Wear...</td>
<td>promask</td>
<td>35</td>
<td>15</td>
<td>20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">119</td>
<td>2020-08-31 01:13:07</td>
<td>WearAMask</td>
<td>1</td>
<td>125</td>
<td>Ariana Grande &amp;amp; Lady Gaga \n💜💜💜💜💜💜💜💜💜💜\n ...</td>
<td>promask</td>
<td>30</td>
<td>10</td>
<td>20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">379</td>
<td>2020-08-30 22:03:47</td>
<td>VoteBlue2020 BidenHarrisToSaveAmerica Register...</td>
<td>4</td>
<td>115</td>
<td>@kylegriffin1 And assh*le golfs.🤬🤬\n#VoteBlue2...</td>
<td>promask</td>
<td>29</td>
<td>9</td>
<td>20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">322</td>
<td>2020-08-30 22:55:31</td>
<td>NaN</td>
<td>0</td>
<td>147</td>
<td>@MagdaSzubanski Thank you, Magda\nYou're a nat...</td>
<td>promask</td>
<td>41</td>
<td>21</td>
<td>20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">524</td>
<td>2020-08-30 20:24:55</td>
<td>twitchstreamer twitch wearamask covid19</td>
<td>4</td>
<td>135</td>
<td>Color coordinating? Never heard of her....\n.\...</td>
<td>promask</td>
<td>43</td>
<td>23</td>
<td>20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2461</td>
<td>2020-08-29 18:37:07</td>
<td>bartender</td>
<td>1</td>
<td>140</td>
<td>I was really hoping we’d get rained out so I’d...</td>
<td>promask</td>
<td>39</td>
<td>19</td>
<td>20</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="502ecb5e" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncomment to view data in a spreadsheet</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#df.to_csv("tweets_with_tokens.csv", index=False)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ve sorted to look where the two methods have few differences and those with many. What patterns do you notice? Look through examples and jot down your observations.</p>
<p>You can also export to a csv to make it easier to view your data.</p>
<section id="modify-tokenization" class="level4">
<h4 class="anchored" data-anchor-id="modify-tokenization">Modify tokenization</h4>
<p>It turns out that <strong>if you want to pre-process data before it hits the tokenizer, you need to process that data before it hits the spacy pipeline</strong>. We may or may not want to use this function, but I’ve created one to do this and have added a “clean_text” column to our dataframe. Some best practices are:</p>
<ul>
<li>Don’t ever delete the original data</li>
<li>Save every version you create and document what you’ve done (notebooks are very handy for this!)</li>
<li>Don’t get so tunnel visioned that you don’t question you need to back-track and modify assumptions later</li>
<li></li>
</ul>
<div id="80ba94d9" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_text(text):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text.lower().replace(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="st">" "</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_tweet(text):</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    nlp <span class="op">=</span> get_nlp()</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nlp(clean_text(text))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="46731005" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>process_tweet(test_tweet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ spaCy model 'en_core_web_sm' loaded successfully</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>omg @drfauci said #wearamask!!! 😷🔥 but my café au lait ☕ costs $3.50... can't breathe w/ masks 🙄 #covid19 #notomasks https://t.co/fake123 rt: "stay safe" 👏👏👏 naïve ppl don't get it 😤</code></pre>
</div>
</div>
<div id="228e0b6a" class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"clean_text"</span>] <span class="op">=</span> df[<span class="st">"tweet_text"</span>].<span class="bu">apply</span>(clean_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f387e274" class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'group'</span>).head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">created_date</th>
<th data-quarto-table-cell-role="th">hashtags</th>
<th data-quarto-table-cell-role="th">num_hashtags</th>
<th data-quarto-table-cell-role="th">tweet_length</th>
<th data-quarto-table-cell-role="th">tweet_text</th>
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">token_count</th>
<th data-quarto-table-cell-role="th">split_count</th>
<th data-quarto-table-cell-role="th">token_diff</th>
<th data-quarto-table-cell-role="th">clean_text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2020-08-31 02:08:31</td>
<td>2020sucks trumpisscar ihateithere wearamask</td>
<td>4</td>
<td>90</td>
<td>#2020sucks #trumpisscar #ihateithere #wearamas...</td>
<td>promask</td>
<td>13</td>
<td>9</td>
<td>4</td>
<td>#2020sucks #trumpisscar #ihateithere #wearamas...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2020-08-31 02:07:58</td>
<td>antimasker antimasking DOJ pandemic</td>
<td>4</td>
<td>137</td>
<td>This is probably one of the most ridiculous of...</td>
<td>promask</td>
<td>23</td>
<td>18</td>
<td>5</td>
<td>this is probably one of the most ridiculous of...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2020-08-31 02:07:28</td>
<td>wearamask maskuphoosiers</td>
<td>2</td>
<td>69</td>
<td>Just, like, do it. #wearamask #maskuphoosiers ...</td>
<td>promask</td>
<td>12</td>
<td>7</td>
<td>5</td>
<td>just, like, do it. #wearamask #maskuphoosiers ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5000</td>
<td>2020-08-31 02:03:58</td>
<td>COVID19 covidhoax</td>
<td>2</td>
<td>125</td>
<td>6% Of all #COVID19 Deaths were from just the v...</td>
<td>antimask</td>
<td>30</td>
<td>23</td>
<td>7</td>
<td>6% of all #covid19 deaths were from just the v...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5001</td>
<td>2020-08-31 02:03:35</td>
<td>COVID19</td>
<td>1</td>
<td>140</td>
<td>#COVID19 is a hoax. Fuck masks. If you don’t ...</td>
<td>antimask</td>
<td>34</td>
<td>25</td>
<td>9</td>
<td>#covid19 is a hoax. fuck masks. if you don’t ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5002</td>
<td>2020-08-31 02:02:55</td>
<td>COVID19 CovidHoax</td>
<td>2</td>
<td>148</td>
<td>@ProfPCDoherty There was no need to shut the b...</td>
<td>antimask</td>
<td>31</td>
<td>23</td>
<td>8</td>
<td>@profpcdoherty there was no need to shut the b...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Now we want to adjust tokenization to leave the “#” connected to the hashtag.</p>
<p><strong>How the spaCy tokenizer works:</strong></p>
<p>The spaCy tokenizer follows a three-step process: 1. First, the tokenizer splits the text on whitespace similar to the split() function. 2. Then the tokenizer checks whether the substring matches the tokenizer exception rules. For example, “don’t” does not contain whitespace, but should be split into two tokens, “do” and “n’t”, while “N.Y.” should remain one token. 3. Then, it checks for a prefix, suffix, or infix in a substring; these include commas, periods, hyphens, or quotes. If it matches, the substring is split into two tokens.</p>
<p>Here’s an illustration of how this works from: https://spacy.io/usage/spacy-101#annotations-token</p>
<p><img src="images/tokenization.png" class="img-fluid"></p>
<p>This tutorial has excellent examples: <a href="https://machinelearningknowledge.ai/complete-guide-to-spacy-tokenizer-with-examples/">https://machinelearningknowledge.ai/complete-guide-to-spacy-tokenizer-with-examples/</a></p>
<p>SpaCy’s tokenizer doesn’t handle hashtags… which makes sense if your data has ‘#’ for other purposes! But you can modify tokenization behavior, if you need to.</p>
<p>Below is a simple algorithm for <strong><code>make_hashtag_friendly_nlp():</code></strong> This function modifies spaCy’s default tokenizer by removing “#” from the list of prefix characters. By default, spaCy treats “#” as a prefix and splits it from the following word. After modification, hashtags like “#wearamask” remain as single tokens instead of being split into “#” and “wearamask”.</p>
<p>We aren’t using this function with our dataset because we were given a csv with hashtags broken out. But imagine you didn’t have them broken out!</p>
<div id="7bee1bce" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spacy.util <span class="im">import</span> compile_prefix_regex</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_hashtag_friendly_nlp():</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    nlp <span class="op">=</span> get_nlp()</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    prefixes <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> nlp.Defaults.prefixes <span class="cf">if</span> p <span class="op">!=</span> <span class="st">"#"</span>]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    prefix_regex <span class="op">=</span> compile_prefix_regex(prefixes)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    nlp.tokenizer.prefix_search <span class="op">=</span> prefix_regex.search</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nlp</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>htag_test <span class="op">=</span> <span class="st">"This is a hashtag #testmyhashtag."</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Default behavior</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>nlp_default <span class="op">=</span> get_nlp()</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Default tokenized text:"</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tok <span class="kw">in</span> nlp_default(htag_test):</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tok)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Modified behavior</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>nlp_hashtag <span class="op">=</span> make_hashtag_friendly_nlp()</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Text after removing the # prefix:"</span>)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tok <span class="kw">in</span> nlp_hashtag(htag_test):</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tok)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ spaCy model 'en_core_web_sm' loaded successfully
Default tokenized text:
This
is
a
hashtag
#
testmyhashtag
.
✅ spaCy model 'en_core_web_sm' loaded successfully

Text after removing the # prefix:
This
is
a
hashtag
#testmyhashtag
.</code></pre>
</div>
</div>
</section>
<section id="gather-some-statistics" class="level4">
<h4 class="anchored" data-anchor-id="gather-some-statistics">Gather some statistics</h4>
<p>Now let’s gather more statistics! - Number of tweets (documents) - Average length in tokens (with histogram and percentile table) - Identify documents that are unusually short or long using spaCy’s token counts - Look for outliers in document length (bottom 1% and top 1%)</p>
<p>Then we’ll look at some of our hashtags.</p>
<p>Again, it’s really useful to export to a CSV file to examine in Excel or whatever you use for viewing structured data if you need to look at your data more carefully.</p>
<div id="80cdc3b3" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'group'</span>).size()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>group
antimask    2069
promask     5000
dtype: int64</code></pre>
</div>
</div>
<p>The number of documents between groups is not equal; we’ll need to keep this in mind for some kinds of comparisons.</p>
<div id="9849d4ef" class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'group'</span>)[<span class="st">'token_count'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>group
antimask    21.899952
promask     22.209600
Name: token_count, dtype: float64</code></pre>
</div>
</div>
<p>Let’s find documents that are unusually short or long using spaCy’s token counts. We’re going to look for <strong>outliers in document length</strong>(bottom 1% and top 1%).</p>
<div id="4dcad639" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"token_count"</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"token_count column is missing; run token count computation first."</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>p1, p99 <span class="op">=</span> df[<span class="st">"token_count"</span>].quantile([<span class="fl">0.01</span>, <span class="fl">0.99</span>]).values</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>short <span class="op">=</span> df[df[<span class="st">"token_count"</span>] <span class="op">&lt;=</span> p1]</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="bu">long</span> <span class="op">=</span> df[df[<span class="st">"token_count"</span>] <span class="op">&gt;=</span> p99]</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="bu">dict</span>(p1<span class="op">=</span>p1, p99<span class="op">=</span>p99, n_short<span class="op">=</span><span class="bu">len</span>(short), n_long<span class="op">=</span><span class="bu">len</span>(<span class="bu">long</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'p1': np.float64(7.0), 'p99': np.float64(34.0), 'n_short': 120, 'n_long': 123}</code></pre>
</div>
</div>
<div id="f2383f6a" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">long</span>.sample(<span class="dv">5</span>)[[<span class="st">'tweet_text'</span>, <span class="st">'token_count'</span>, <span class="st">'group'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tweet_text</th>
<th data-quarto-table-cell-role="th">token_count</th>
<th data-quarto-table-cell-role="th">group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">29</td>
<td>#RwOT If your glasses "fog" when you’re wearin...</td>
<td>34</td>
<td>promask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5610</td>
<td>@Aspies123 Maybe they know something you don't...</td>
<td>34</td>
<td>antimask</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2049</td>
<td>#WhyRepublicansAreJumpingShip\n- BC the RIOTS ...</td>
<td>34</td>
<td>promask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4456</td>
<td>Given that all the leftists in NZ, Aus, Canada...</td>
<td>36</td>
<td>promask</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6069</td>
<td>"Science changes" when you want it to! It's su...</td>
<td>34</td>
<td>antimask</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="fe717a4c" class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>short.sample(<span class="dv">5</span>)[[<span class="st">'tweet_text'</span>, <span class="st">'token_count'</span>, <span class="st">'group'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tweet_text</th>
<th data-quarto-table-cell-role="th">token_count</th>
<th data-quarto-table-cell-role="th">group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5176</td>
<td>Major boom #covidHoax https://t.co/LfZx84JyQh</td>
<td>5</td>
<td>antimask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>Lady Gaga #WearAMask \n#LadyGaga</td>
<td>7</td>
<td>promask</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2344</td>
<td>I agree...#WearAMask #leadersgiveexample https...</td>
<td>7</td>
<td>promask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">63</td>
<td>Facts. #WearAMask https://t.co/tPsE35rIf5</td>
<td>5</td>
<td>promask</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3748</td>
<td>I miss coaching ball #WearAMask</td>
<td>6</td>
<td>promask</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>What we can see is that the shortest 1% of tweets have 7 or fewer tokens. The longest 1% have 34+ tokens and may contain a lot of emoji or punctuation that spaCy splits up.</p>
</section>
<section id="hashtags" class="level4">
<h4 class="anchored" data-anchor-id="hashtags">Hashtags</h4>
<p>Let’s think about hashtags now. If we want to compare counts across groups we’ll need to normalize them. We already know the groups are not the same size. Raw counts would simply reflect a greater opportunity for hashtags to appear—not a stronger association with the group.</p>
<p>When we normalize hashtag frequencies, we can ask questions such as <em>how characteristic is this hashtag (per group) relative to the overall group’s hashtag activity?</em> We can think of this as an analysis of hashtag <strong>saliency</strong> (the degree to which something stands out or is prominent) rather than volume.</p>
<p>To normalize, we’ll count how often each hashtag appears in the group and then divide by the total. This is a <strong>relative frequency</strong>. This answers the question: <em>Out of all the hashtags used by this group, how prominent is this one?</em></p>
<p><strong>Hashtag normalization:</strong></p>
<p>The code below: - explodes the hashtag column so each hashtag gets its own row - counts occurrences per group - computes the total hashtags per group, and - divides each hashtag count by the group total to get relative frequency.</p>
<div id="5bdd9b26-7838-4302-81d1-ff16f46670f8" class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># explode hashtags into one-per-row</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>hashtags <span class="op">=</span> (</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    df.dropna(subset<span class="op">=</span>[<span class="st">"hashtags"</span>])</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>      .assign(hashtag<span class="op">=</span>df[<span class="st">"hashtags"</span>].<span class="bu">str</span>.split())</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>      .explode(<span class="st">"hashtag"</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># count hashtags per group</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>hashtag_counts <span class="op">=</span> (</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    hashtags.groupby([<span class="st">"group"</span>, <span class="st">"hashtag"</span>])</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>            .size()</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>            .rename(<span class="st">"count"</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>            .reset_index()</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co"># total hashtags per group</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>total_hashtags <span class="op">=</span> (</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    hashtag_counts.groupby(<span class="st">"group"</span>)[<span class="st">"count"</span>]</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>                   .<span class="bu">sum</span>()</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>                   .rename(<span class="st">"total"</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co"># join and normalize</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>hashtag_norm <span class="op">=</span> (</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    hashtag_counts</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>        .merge(total_hashtags, on<span class="op">=</span><span class="st">"group"</span>)</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>        .assign(rel_freq<span class="op">=</span><span class="kw">lambda</span> d: d[<span class="st">"count"</span>] <span class="op">/</span> d[<span class="st">"total"</span>])</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>        .sort_values([<span class="st">"group"</span>, <span class="st">"rel_freq"</span>], ascending<span class="op">=</span>[<span class="va">True</span>, <span class="va">False</span>])</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect top normalized hashtags</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>hashtag_norm.groupby(<span class="st">"group"</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">hashtag</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">total</th>
<th data-quarto-table-cell-role="th">rel_freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">139</td>
<td>antimask</td>
<td>CovidHoax</td>
<td>707</td>
<td>2982</td>
<td>0.237089</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">642</td>
<td>antimask</td>
<td>covidhoax</td>
<td>218</td>
<td>2982</td>
<td>0.073105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">71</td>
<td>antimask</td>
<td>COVID19</td>
<td>110</td>
<td>2982</td>
<td>0.036888</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">70</td>
<td>antimask</td>
<td>COVID</td>
<td>47</td>
<td>2982</td>
<td>0.015761</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">370</td>
<td>antimask</td>
<td>NoMasks</td>
<td>40</td>
<td>2982</td>
<td>0.013414</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">635</td>
<td>antimask</td>
<td>covidHOAX</td>
<td>40</td>
<td>2982</td>
<td>0.013414</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">797</td>
<td>antimask</td>
<td>plandemic</td>
<td>40</td>
<td>2982</td>
<td>0.013414</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">627</td>
<td>antimask</td>
<td>coronavirus</td>
<td>37</td>
<td>2982</td>
<td>0.012408</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">407</td>
<td>antimask</td>
<td>Plandemic</td>
<td>36</td>
<td>2982</td>
<td>0.012072</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">466</td>
<td>antimask</td>
<td>Scamdemic</td>
<td>34</td>
<td>2982</td>
<td>0.011402</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2229</td>
<td>promask</td>
<td>WearAMask</td>
<td>1893</td>
<td>7790</td>
<td>0.243004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3521</td>
<td>promask</td>
<td>wearamask</td>
<td>419</td>
<td>7790</td>
<td>0.053787</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1059</td>
<td>promask</td>
<td>COVID19</td>
<td>262</td>
<td>7790</td>
<td>0.033633</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2275</td>
<td>promask</td>
<td>WritingCommunity</td>
<td>88</td>
<td>7790</td>
<td>0.011297</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1950</td>
<td>promask</td>
<td>StayAtHomeSaveLives</td>
<td>86</td>
<td>7790</td>
<td>0.011040</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1085</td>
<td>promask</td>
<td>COVIDー19</td>
<td>79</td>
<td>7790</td>
<td>0.010141</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2226</td>
<td>promask</td>
<td>WearADamnMask</td>
<td>67</td>
<td>7790</td>
<td>0.008601</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2490</td>
<td>promask</td>
<td>coronavirus</td>
<td>63</td>
<td>7790</td>
<td>0.008087</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3513</td>
<td>promask</td>
<td>washyourhands</td>
<td>53</td>
<td>7790</td>
<td>0.006804</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2934</td>
<td>promask</td>
<td>mask</td>
<td>47</td>
<td>7790</td>
<td>0.006033</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Glaringly obvious now is that we haven’t attempted to normalize case or spelling of hashtags.</p>
<p><strong>Always remember that these seemingly mundane details of preprocessing can have substantial impact on your analysis.</strong> Imagine what would happen to a sentiment analysis program that removed negation (e.g.&nbsp;not and n’t) - how would it differentiate between not happy and happy?!</p>
<p>And, while we just normalized total hashtags, you could also normalize across the number of tweets.</p>
<p>Let’s look at a side-by-side table of our group’s normalized frequencies</p>
<div id="a1c86ef9-102b-4acb-80a9-d4ca6bc123eb" class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot to side-by-side table</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>hashtag_pivot <span class="op">=</span> (</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    hashtag_norm</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>        .pivot(index<span class="op">=</span><span class="st">"hashtag"</span>, columns<span class="op">=</span><span class="st">"group"</span>, values<span class="op">=</span><span class="st">"rel_freq"</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>        .fillna(<span class="dv">0</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># show hashtags that are prominent in either group</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>hashtag_pivot</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    .assign(max_freq<span class="op">=</span><span class="kw">lambda</span> d: d.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">"max_freq"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"max_freq"</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">15</span>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">antimask</th>
<th data-quarto-table-cell-role="th">promask</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">hashtag</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">WearAMask</td>
<td>0.000671</td>
<td>0.243004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CovidHoax</td>
<td>0.237089</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">covidhoax</td>
<td>0.073105</td>
<td>0.000128</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">wearamask</td>
<td>0.001006</td>
<td>0.053787</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">COVID19</td>
<td>0.036888</td>
<td>0.033633</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">COVID</td>
<td>0.015761</td>
<td>0.004236</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">covidHOAX</td>
<td>0.013414</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">plandemic</td>
<td>0.013414</td>
<td>0.000257</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">NoMasks</td>
<td>0.013414</td>
<td>0.000257</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">coronavirus</td>
<td>0.012408</td>
<td>0.008087</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Plandemic</td>
<td>0.012072</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Scamdemic</td>
<td>0.011402</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">WritingCommunity</td>
<td>0.000335</td>
<td>0.011297</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">StayAtHomeSaveLives</td>
<td>0.000000</td>
<td>0.011040</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">COVIDHOAX</td>
<td>0.010396</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Some directions you could go with this:</p>
<p>Which hashtags appear strongly associated with one group but nearly absent in the other?</p>
<p>Which hashtags appear in both groups, but with very different relative frequencies?</p>
<p>How does normalization change your interpretation compared to raw counts?</p>
<p>Even accounting for case differences and aggregrating counts where there are spelling differences, stylistic choices will still fragment the signal.</p>
<p>A <strong>discriminative</strong> analytical approach would move you towards looking at what hashtags are most characteristic (or disproportionately associated with) each group.</p>
</section>
<section id="emojis" class="level4">
<h4 class="anchored" data-anchor-id="emojis">Emojis</h4>
<p>Another kind of “word” you could look at are emojis. As you go through this analysis, think about what emoji mean. Do they participate in irony, sarcasm? Do they indicate mood, feelings? What are the many ways people use emoji in short-form text like this?</p>
<p>In the cell below, we are using the regex library to find a pattern with the unicode property. means “match any character with this unicode property.” If you are already familiar with regular expressions, <strong>Regex</strong> has much better support for unicode than <strong>re</strong>.</p>
<p>Next week, you have the opportunity to take a regex lab (or a continuation of this one which is more advanced). <code>\p{Emoji_Presentation}</code> below is a unicode binary property you can reference from this page: <a href="https://www.regular-expressions.info/refunicodeproperty.html">https://www.regular-expressions.info/refunicodeproperty.html</a>. Unicode is a huge and important topic in NLP. We’ll just touch on the basics.</p>
<div id="b229c788-59d7-44f3-b6aa-c605bf801f34" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> regex <span class="im">as</span> re</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">#EMOJI_PATTERN = re.compile(r"\p{Emoji}")</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Gets rid of most stray # and digits</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>EMOJI_PATTERN <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r"\p</span><span class="sc">{Emoji_Presentation}</span><span class="vs">"</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_emoji(text):</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> EMOJI_PATTERN.findall(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="33bec8c3-4153-4b21-905c-b2874dfe21bc" class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_emojis(text):</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> get_emoji(text)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"emojis"</span>] <span class="op">=</span> df[<span class="st">"tweet_text"</span>].<span class="bu">apply</span>(extract_emojis)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"emoji_count"</span>] <span class="op">=</span> df[<span class="st">"emojis"</span>].<span class="bu">apply</span>(<span class="bu">len</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">"tweet_text"</span>, <span class="st">"emojis"</span>, <span class="st">"emoji_count"</span>]].tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tweet_text</th>
<th data-quarto-table-cell-role="th">emojis</th>
<th data-quarto-table-cell-role="th">emoji_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">7064</td>
<td>@bombmunchkin Stop giving away MY Dating secre...</td>
<td>[]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7065</td>
<td>Advertisers only advertise when they want mark...</td>
<td>[]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7066</td>
<td>@robowen18 @annieow81 @4dannyboy @mattletiss7 ...</td>
<td>[]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7067</td>
<td>Another amusing musical video from Media Bear ...</td>
<td>[🤣, 👍, 😂]</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7068</td>
<td>#Republicans say the #RadicalLeft #LiberalismI...</td>
<td>[]</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="440e6747-1eb9-473d-a66c-16a060e9cb1d" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"group"</span>)[<span class="st">"emoji_count"</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">antimask</td>
<td>2069.0</td>
<td>0.17593</td>
<td>0.810939</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>14.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">promask</td>
<td>5000.0</td>
<td>0.31700</td>
<td>1.149598</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>22.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="e4bfba8c-d4b8-44d1-8c5f-8369f2ffe78c" class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>emoji_counts <span class="op">=</span> (</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    .explode(<span class="st">"emojis"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    .dropna(subset<span class="op">=</span>[<span class="st">"emojis"</span>])</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"group"</span>)[<span class="st">"emojis"</span>]</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> x: Counter(x).most_common(<span class="dv">20</span>))</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>emoji_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>group
antimask    [(👇, 35), (💥, 27), (😂, 22), (🤣, 20), (👏, 20), ...
promask     [(😷, 317), (🏻, 46), (👇, 43), (🙏, 35), (🏾, 33),...
Name: emojis, dtype: object</code></pre>
</div>
</div>
<p>You may see some empty square boxes when you start digging into emoji and other unicode characters.</p>
<p>When we decided to look at emojis as Unicode, we picked up standalone characters that are designed to combine with a base emoji. Skin-tone modifiers combine with other characters, though when by themselves they are rendered as placeholders. They were split off from their base emoji. To fix further, we would need to treat them together and use another approach to extract them.</p>
<p>Consider the following questions:</p>
<p>Which emojis appear strongly associated with one group?</p>
<p>Which emojis appear in both groups but with very different relative frequencies?</p>
<p>How do emoji patterns compare to hashtags in terms of emotional tone or stance?</p>
<p><strong>Stance</strong> refers to the speaker’s or writer’s position, attitude, or point of view toward a topic, idea, or other participants in discourse. It’s clear that emojis are rich signals that communicate affect (feelings), opinions, social cues such as solidarity, and more. We’ll look at <strong>stance</strong> more next week.</p>
</section>
<section id="section-a-summary-token-level-distributions" class="level3">
<h3 class="anchored" data-anchor-id="section-a-summary-token-level-distributions">Section A Summary: Token-Level Distributions</h3>
<p>In this section, you learned how to: - <strong>Build vocabulary sets</strong> and count unique word types across different groups - <strong>Compare tokenization methods</strong> (simple <code>split()</code> vs.&nbsp;spaCy) and understand why they produce different results - <strong>Identify tokenization challenges</strong> in social media text: hashtags, emoji, punctuation, contractions, and special characters - <strong>Customize spaCy’s tokenizer</strong> by modifying prefix rules to keep hashtags intact - <strong>Calculate descriptive statistics</strong> including document counts, token counts, and percentile distributions - <strong>Normalize frequency counts</strong> to enable fair comparisons between groups of different sizes - <strong>Recognize preprocessing pitfalls</strong> such as case sensitivity and the impact of seemingly minor decisions on downstream analysis</p>
<p>The key takeaway is that tokenization choices directly affect your vocabulary size and frequency counts—always document your preprocessing decisions and be prepared to revisit them.</p>
</section>
<section id="reflection" class="level3">
<h3 class="anchored" data-anchor-id="reflection">Reflection</h3>
<ol type="1">
<li><p>Is a dataset created with hashtags such (#covidhoax OR #notomask) and (#covidisreal OR #wearmask) <em>representative</em> of the breadth of conversation on Twitter regarding Covid-19 (at that time)? Why or why not?</p></li>
<li><p>How might you go about expanding coverage on the topic? In thinking about this, consider how you would address representativeness vs.&nbsp;balance for some imagined task, such as assessing public sentiment about covid or about wearing masks?</p></li>
</ol>
<div id="d2954084-3522-4f13-818b-db7035ad6cea" class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>q1_answer <span class="op">=</span> <span class="st">"Do you think these datasets are representative of Twitter conversation about Covid-19 (at that time)? Why or why not?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7161db97-2949-4bd7-976e-c716ec092dbd" class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>q2_answer <span class="op">=</span> <span class="st">"How might you expand coverage to address representativeness vs balance on some particular task such as public sentiment?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="b---visualize" class="level2">
<h2 class="anchored" data-anchor-id="b---visualize">B - Visualize</h2>
<section id="document-length-distribution" class="level4">
<h4 class="anchored" data-anchor-id="document-length-distribution">Document length distribution</h4>
<p>Let’s start with the average length of document (tweet) as measured by token count. This plot shows how length is distributed.</p>
<div id="c283e0fa" class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grp <span class="kw">in</span> [<span class="st">'promask'</span>, <span class="st">'antimask'</span>]:</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    df[df.group <span class="op">==</span> grp][<span class="st">'token_count'</span>].hist(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>        density<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>grp,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Token Count'</span>)</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Density'</span>)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'group'</span>)[<span class="st">'token_count'</span>].describe(</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    percentiles<span class="op">=</span>[<span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.25</span>, <span class="fl">.5</span>, <span class="fl">.75</span>, <span class="fl">.95</span>, <span class="fl">.99</span>]</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_eda_spacy_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">1%</th>
<th data-quarto-table-cell-role="th">5%</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">95%</th>
<th data-quarto-table-cell-role="th">99%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">antimask</td>
<td>2069.0</td>
<td>21.899952</td>
<td>5.977403</td>
<td>4.0</td>
<td>6.0</td>
<td>10.0</td>
<td>19.0</td>
<td>23.0</td>
<td>26.0</td>
<td>30.0</td>
<td>33.0</td>
<td>44.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">promask</td>
<td>5000.0</td>
<td>22.209600</td>
<td>6.435336</td>
<td>3.0</td>
<td>7.0</td>
<td>10.0</td>
<td>18.0</td>
<td>23.0</td>
<td>27.0</td>
<td>31.0</td>
<td>35.0</td>
<td>67.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>These are very similar.</p>
<p>Both groups: - exhibit right-skewed token count distributions - have similar central tendencies</p>
<p>This is useful because differences in our observations will be unlikely due to document length.</p>
<p>It probably won’t be practical to visualize all the words in our corpus, so let’s start by showing the top 30 after filtering out stopwords, punctuation, numbers, and spaces.</p>
<p>It probably won’t be practical to visualize all the words in our corpus, so let’s start by showing the top 30 after filtering out stopwords, punctuation, numbers, and spaces.</p>
<p>The code below processes each tweet through spaCy, filters tokens to exclude stopwords, punctuation, numbers, and whitespace, counts the remaining tokens, and displays the top 30 most frequent words as horizontal bar charts for each group.</p>
<div id="473ea91d" class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>num_to_plot <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, group <span class="kw">in</span> <span class="bu">zip</span>(axes, [<span class="st">'promask'</span>, <span class="st">'antimask'</span>]):</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    texts <span class="op">=</span> df[df[<span class="st">'group'</span>] <span class="op">==</span> group][<span class="st">'clean_text'</span>]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    word_counts <span class="op">=</span> Counter()</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># batch processing with spaCy. nlp.pipe() is 10-50x faster</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># on real corpora. EDA on text is often bottlenecked by NLP</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pipelines not analysis in pandas</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> doc <span class="kw">in</span> nlp.pipe(texts, batch_size<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> token <span class="kw">in</span> doc:</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>                <span class="kw">not</span> token.is_stop</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>                <span class="kw">and</span> <span class="kw">not</span> token.is_punct</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>                <span class="kw">and</span> <span class="kw">not</span> token.like_num</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>                <span class="kw">and</span> <span class="kw">not</span> token.is_space</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>            ):</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>                word_counts[token.text] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>    top_words <span class="op">=</span> word_counts.most_common(num_to_plot)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    words, counts <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>top_words)</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    ax.barh(words[::<span class="op">-</span><span class="dv">1</span>], counts[::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Frequency'</span>)</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'Top </span><span class="sc">{</span>num_to_plot<span class="sc">}</span><span class="ss"> words — </span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_eda_spacy_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="keyword-in-context" class="level4">
<h4 class="anchored" data-anchor-id="keyword-in-context">Keyword-in-Context</h4>
<p>The function below is known as a <strong>“keyword in context” (KWIC)</strong> visualization, or <strong>concordance</strong>. A concordance is a traditional corpus linguistics tool that displays all occurrences of a word along with its surrounding context, allowing analysts to see patterns in how words are actually used.</p>
<p>The <strong><code>kwic_spacy():</code></strong> function below works in three steps: 1. <strong>Loop through texts</strong> — For each tweet, create a spaCy Doc 2. <strong>Find matches</strong> — Loop through tokens, check if each matches the keyword (case-insensitive) 3. <strong>Extract context</strong> — When a match is found, grab <em>window</em> tokens before and after</p>
<p>The key is getting the context window so your keyword is lined up nicely with token context:</p>
<p><code>doc[max(0, i-window):i]</code> — slice of tokens before the match (using max(0,…) to avoid negative indices)</p>
<p><code>doc[i+1:i+1+window]</code> — slice of tokens after the match</p>
<p>The <code>:&gt;40</code> in the f-string right-aligns the left context to 40 characters, so the keyword lines up nicely in a column.</p>
<div id="1b54ba99" class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> kwic_spacy(texts, keyword, window<span class="op">=</span><span class="dv">5</span>, n<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> doc <span class="kw">in</span> nlp.pipe(texts, batch_size<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, token <span class="kw">in</span> <span class="bu">enumerate</span>(doc):</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> token.text.lower() <span class="op">==</span> keyword.lower():</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                left <span class="op">=</span> doc[<span class="bu">max</span>(<span class="dv">0</span>, i<span class="op">-</span>window):i].text.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">' '</span>)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                right <span class="op">=</span> doc[i<span class="op">+</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span><span class="op">+</span>window].text.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">' '</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                results.append(<span class="ss">f"</span><span class="sc">{</span>left<span class="sc">:&gt;40}</span><span class="ss"> [</span><span class="sc">{</span>token<span class="sc">.</span>text<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span>right<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(results) <span class="op">&gt;=</span> n:</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> results</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ve got a weird “amp” in our list. This looks suspiciously like poorly handled html codes. Let’s explore that hypothesis with a quick concordance(key word in context or kwic) view.</p>
<div id="cd10d803-cd7b-42ef-95ff-27066451b3cf" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>nlp <span class="op">=</span> get_nlp()</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>kwic_spacy(df[<span class="st">'clean_text'</span>],<span class="st">"amp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ spaCy model 'en_core_web_sm' loaded successfully</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>["                ordered your semper fi &amp; [amp] ; america's fund face",
 '                         on now. darcy &amp; [amp] ; stacey. #darceyandstacey',
 '                     does not fit well &amp; [amp] ; too much… https://t.co/oumpor5r0k',
 '              #staysafe #speakyourmind &amp; [amp] ; #wearamask 😷 https://t.co/ml01hrikiz',
 '          : 25,378,371 confirmed cases &amp; [amp] ; 850,163 deaths 90 countries',
 '                          if @ladygaga &amp; [amp] ; her team can completely',
 '                     tweeps. take care &amp; [amp] ; stay safe! #',
 '           good to see @usembassynepal &amp; [amp] ; @usambnepal promoting #wearamask',
 '      @usambnepal promoting #wearamask &amp; [amp] ; #maskchallenge even when',
 '          greg armstrong, epidemiology &amp; [amp] ; cancer control.  ',
 '                         ariana grande &amp; [amp] ; lady gaga  💜',
 '                   all over the states &amp; [amp] ; continuing to spread…',
 '                      if @arianagrande &amp; [amp] ; @ladygaga can do a',
 '                             if ariana &amp; [amp] ; lady gaga can wear',
 "                  don't want @nzpolice &amp; [amp] ; us compan… https://t.co/ibicw9qv8k",
 '                mask that protects you &amp; [amp] ;… https://t.co/fr5v3fazo9',
 '            congratulations, @ladygaga &amp; [amp] ; @arianagrande!  that',
 '               pneumonia. many friends &amp; [amp] ; family have brought meals',
 '                  to keep your friends &amp; [amp] ; family safe and healthy',
 '                      love you to bits &amp; [amp] ; back ❤️💚']</code></pre>
</div>
</div>
<p>To fix the “amp” issue (and other html artifacts), we could add this right after we created clean_text.</p>
<pre><code>import html

df['clean_text'] = df['clean_text'].apply(html.unescape)</code></pre>
<p>While kwic is very useful for analysis – it’s also handy for EDA!</p>
</section>
<section id="reflection-1" class="level4">
<h4 class="anchored" data-anchor-id="reflection-1">Reflection</h4>
<ol type="1">
<li><p>Why can a term be very frequent but still uninformative about group stance? Give an example from the hashtag or emoji analyses.</p></li>
<li><p>What does dispersion tell you that raw frequency cannot? In what situations would you trust dispersion more than frequency?</p></li>
<li><p>Choose one hashtag or emoji that appears in both groups. Based on KWIC or examples, does it appear to serve the same communicative function in each group?</p></li>
</ol>
<div id="8d45aaa8-009f-4671-baf8-250caa9d86b9" class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>q3_answer <span class="op">=</span> <span class="st">"Give an example of a frequent but uninformative term about group stance."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="eb2e1d06-4c17-48c4-b0a8-5313ba61c1dd" class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>q4_answer <span class="op">=</span> <span class="st">"What does dispersion tell you that raw frequency cannot?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="27157774-d694-4d84-9f29-8cb0ab05df61" class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>q5_answer <span class="op">=</span> <span class="st">"Hashtag or emoji.. Based on KWIC or examples, does it serve the same communicative function?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="c---distributional-patterns" class="level2">
<h2 class="anchored" data-anchor-id="c---distributional-patterns">C - Distributional Patterns</h2>
<p>Frequency alone is inadequate for revealing patterns of use. Let’s look for high-frequency, low-dispersion terms. <strong>Dispersion</strong> measures how evenly or unevenly a word (or linguistic structure) is spread across different parts of a text corpus or dataset. Dispersion complements frequency by showing <em>where</em> observations occur rather than <em>how often</em>.</p>
<p>For example, a small number of users in our Twitter data could be responsible for boosting the frequency of specific terms. These could matter since they might reveal: - Bot activity - Coordinated messaging campaigns - Copy-paste patterns - Influential user amplification</p>
<p><strong>Distributional analysis</strong> in NLP is a method that finds word meanings by analyzing their surrounding contexts. It gets at “patterns of use” rather than isolated metrics. We’ll dig in much more deeply into distributional analysis because it is one of the most important concepts in both NLP and LLMs.</p>
<p>Let’s look at hashtags. We can plot in a variety of ways, though for our purposes it would be fun to compare between groups.</p>
<p>Let’s look at hashtags. We can plot in a variety of ways, though for our purposes it would be fun to compare between groups.</p>
<div id="f81a2155" class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">4</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, group <span class="kw">in</span> <span class="bu">zip</span>(axes, [<span class="st">'promask'</span>, <span class="st">'antimask'</span>]):</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'group'</span>] <span class="op">==</span> group].reset_index()</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    ax.scatter(</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>        subset.index,</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>        subset[<span class="st">'num_hashtags'</span>],</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.3</span>,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>        s<span class="op">=</span><span class="dv">5</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Tweet index'</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss"> – hashtag count dispersion'</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Number of hashtags'</span>)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_eda_spacy_files/figure-html/cell-43-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This plot is about <strong>dispersion</strong>. It shows a dense cluster of 0-4 hashtags but with some sparse outliers in each group.</p>
<p>It looks like it’s common to have up to about 4 hashtags. What do samples containing 8 more more look like?</p>
<div id="5312f8c2" class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's expand our display so we can see the entire tweet text</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_colwidth'</span>, <span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="875b819e" class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the extreme tail of the hashtag distribution (unusually hashtag-dense tweets)</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">"num_hashtags"</span>] <span class="op">&gt;=</span> <span class="dv">8</span>][</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"tweet_text"</span>, <span class="st">"num_hashtags"</span>, <span class="st">"group"</span>]</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>].head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tweet_text</th>
<th data-quarto-table-cell-role="th">num_hashtags</th>
<th data-quarto-table-cell-role="th">group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">193</td>
<td>#startup #healthcare #stayhome #staysafe #hopeforthebest #wearamask #washyourhands #protectyourself #protectothers… https://t.co/DGOFzacYD4</td>
<td>9</td>
<td>promask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">342</td>
<td>#sundayinspiration got mask? \n.\n.\n.\n#gotmask #covid19nyc #covidharlem #pandemic #itsnotover #staysafer #wearamask… https://t.co/Wr24AO2sqq</td>
<td>8</td>
<td>promask</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">405</td>
<td>#Calling all #CoastlineCollege #students! Want a chance to #WIN #free #staycation #swag? Send us a #selfie wearing… https://t.co/bwDWdu2Eiq</td>
<td>8</td>
<td>promask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">408</td>
<td>#quote #quoteoftheday #quotetoliveby #monday #inaworld #world #beanything #anything #bekind #kind #kindness… https://t.co/FRokelPXFL</td>
<td>11</td>
<td>promask</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">588</td>
<td>Mask up Washington 😷 \n.\n.\n.\n#maskup #maskupwashington #wearamask #wearyourmask #mask #selfie #maskselfie #hike… https://t.co/kv5QVJX4cp</td>
<td>8</td>
<td>promask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">619</td>
<td>#sevenmile #sunday #wearamask l went with the #murdershewrote #jessicafletcher #angelalansbury #mask #NRC #NIKE… https://t.co/WMPfYNtBrG</td>
<td>9</td>
<td>promask</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">655</td>
<td>welcome to the Party #Nov3 #WearAMask #JoeBiden #VoteBlue #resist #CoronaVirus #NotMyPresident #VoteByMail… https://t.co/vuyCboZ1jV</td>
<td>8</td>
<td>promask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">825</td>
<td>This is terrifying. #WearAMask #TakeCare #ByKind #Beach #BeachLife #Sunday #SundayFunDay #BeachMask https://t.co/4Vw3GnRzoz</td>
<td>8</td>
<td>promask</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1004</td>
<td>#BidenHarris #BidenHarris2020 #NastyWoman #RidinWithBiden #NastyWomanForBiden #Masks #WearAMask #StopTheSpread… https://t.co/wemxjE0LQY</td>
<td>8</td>
<td>promask</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1040</td>
<td>#sneezing with your #mask on feels like shitting your pants with your face! #funny #COVID19 #WearAMask #maskdebate #coronavirus #rona</td>
<td>8</td>
<td>promask</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>The hyperlinks in the tweet_text still link to X (Twitter). Can you look at some and guess which are real people and which aren’t?</p>
<p>Let’s play around with dispersions on other sorts of words!</p>
<div id="b72a4e12" class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># list some of the words we want to examine</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>pandemic_words <span class="op">=</span>   [<span class="st">"pandemic"</span>, <span class="st">"CDC"</span>, <span class="st">"cure"</span>, <span class="st">"science"</span>, <span class="st">"vaccine"</span>, <span class="st">"virus"</span>, <span class="st">"guidelines"</span>, <span class="st">"mask"</span>, <span class="st">"masks"</span>, <span class="st">"FDA"</span>]</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>conspiracy_words <span class="op">=</span> [<span class="st">"plandemic"</span>, <span class="st">"scamdemic"</span>, <span class="st">"hoax"</span>]</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>search_words <span class="op">=</span> pandemic_words</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>moral_words <span class="op">=</span> [<span class="st">"like"</span>, <span class="st">"love"</span>, <span class="st">"adore"</span>, <span class="st">"dislike"</span>, <span class="st">"hate"</span>, <span class="st">"abhor"</span>, <span class="st">"detest"</span>, <span class="st">"sickening"</span>]</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>some_stopwords <span class="op">=</span> [<span class="st">"for"</span>,<span class="st">"a"</span>, <span class="st">"the"</span>, <span class="st">"and"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5fce8c71" class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, group <span class="kw">in</span> <span class="bu">zip</span>(axes, [<span class="st">'promask'</span>, <span class="st">'antimask'</span>]):</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'group'</span>] <span class="op">==</span> group][<span class="st">'clean_text'</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> conspiracy_words:</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>        positions <span class="op">=</span> [</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>            i <span class="cf">for</span> i, text <span class="kw">in</span> <span class="bu">enumerate</span>(subset)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> word.lower() <span class="kw">in</span> text.lower()</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>        ax.scatter(</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>            positions,</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>            [word] <span class="op">*</span> <span class="bu">len</span>(positions),</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>            alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>            s<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span>word</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Tweet index'</span>)</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>    ax.set_title(group)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Dispersion of conspiracy words'</span>)</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="02_eda_spacy_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This plot is very cool! It shows where words occur… not how often. Try some yourself!</p>
<p>In this section, you learned: - <strong>Dispersion</strong> complements frequency by showing where words occur across a corpus, not just how often - High frequency with low dispersion may indicate bot activity, coordinated campaigns, or copy-paste behavior - <strong>KWIC (Keyword in Context)</strong> concordances let you inspect the actual usage contexts of words - HTML artifacts (like <code>&amp;amp;</code>) are common in web-scraped text and should be unescaped during preprocessing - <strong>Dispersion plots</strong> visualize word occurrence across document indices, revealing clustering patterns - Different word categories (pandemic terms, conspiracy terms, moral/emotional terms) show distinct distributional signatures across groups</p>
<p>The key insight is that <em>where</em> words appear can be as informative as <em>how often</em> they appear—distributional analysis is foundational to understanding meaning in both classical NLP and modern LLMs.</p>
<section id="reflection-2" class="level4">
<h4 class="anchored" data-anchor-id="reflection-2">Reflection</h4>
<ul>
<li><p>Two groups can have similar averages but very different distributions. What kinds of linguistic or social processes could produce that situation?</p></li>
<li><p>What does dispersion reveal that frequency hides? In what scenario would dispersion be more trustworthy than frequency?</p></li>
<li><p>What patterns in the dispersion plots might indicate coordinated behavior, automation, or amplification rather than organic language use?</p></li>
</ul>
<div id="006e79d0-7074-4c9e-95b0-95235fce6c58" class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>q6_answer <span class="op">=</span> <span class="st">"Linguistic or social processes similar averages different distributions"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6e9bebc3-9980-42f9-8cbd-6d16d0611f4b" class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>q7_answer <span class="op">=</span> <span class="st">"Scenario where dispersion is more trustworthy than frequency"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="81870c7c-2ec2-428f-993f-c97ef5a67e7b" class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>q8_answer <span class="op">=</span> <span class="st">"Pattern that might indicate a coordinated / automated behavior"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="d---lexical-variety-through-lemmatization" class="level2">
<h2 class="anchored" data-anchor-id="d---lexical-variety-through-lemmatization">D - Lexical Variety Through Lemmatization</h2>
<p>In Sections A and B, we analyzed surface tokens — what people literally typed. In this section, we ask a different question: how much lexical variety exists once we collapse inflectional variants that express the same underlying word?</p>
<p>Lemmatization lets us approximate <strong>semantic diversity</strong> rather than <strong>stylistic variation</strong>.</p>
<p>Examples of lexical variation across word forms approximating the same meaning:</p>
<ul>
<li>mask, masks, masked, masking</li>
<li>lie, lies, lying, lied</li>
<li>die, dies, dying, died</li>
</ul>
<p>Are these different ideas, or different realizations of the same idea?</p>
<p>What can we see if we lemmatize our data. Will we see a condensed semantic representation of discourse?</p>
<div id="b87ce3bc-60e5-44c4-8618-26081b3eb1e4" class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build spaCy Docs (again). We're using a batch size to to help normalize</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>nlp <span class="op">=</span> get_nlp()</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>docs_promask <span class="op">=</span> <span class="bu">list</span>(nlp.pipe(</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    df[df[<span class="st">"group"</span>] <span class="op">==</span> <span class="st">"promask"</span>][<span class="st">"clean_text"</span>],</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">1000</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>docs_antimask <span class="op">=</span> <span class="bu">list</span>(nlp.pipe(</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    df[df[<span class="st">"group"</span>] <span class="op">==</span> <span class="st">"antimask"</span>][<span class="st">"clean_text"</span>],</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">1000</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ spaCy model 'en_core_web_sm' loaded successfully</code></pre>
</div>
</div>
<p>The function below iterates over spaCy docs (already lemmatized) and filters to “content” words. It keeps words that are alphabetic and not stopwords. It then stores them in a set so each lemma is counted once.</p>
<div id="w8xgnpdz3l" class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_unique_lemmas(docs):</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Extract unique content-word lemmas from pre-parsed spaCy Docs.</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    lemmas <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> doc <span class="kw">in</span> docs:</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tok <span class="kw">in</span> doc:</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>                tok.is_alpha</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>                <span class="kw">and</span> <span class="kw">not</span> tok.is_stop</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>            ):</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>                lemmas.add(tok.lemma_.lower())</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lemmas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s get unique lemmas for both promask and antimask, and also those that are shared.</p>
<div id="9d701c9a-eb40-41fb-bd36-e5938ad15b97" class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>promask_lemmas <span class="op">=</span> get_unique_lemmas(docs_promask)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>antimask_lemmas <span class="op">=</span> get_unique_lemmas(docs_antimask)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>unique_to_promask_lemmas <span class="op">=</span> promask_lemmas <span class="op">-</span> antimask_lemmas</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>unique_to_antimask_lemmas <span class="op">=</span> antimask_lemmas <span class="op">-</span> promask_lemmas</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>shared_lemmas <span class="op">=</span> promask_lemmas <span class="op">&amp;</span> antimask_lemmas</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>(<span class="bu">len</span>(promask_lemmas), <span class="bu">len</span>(antimask_lemmas), <span class="bu">len</span>(shared_lemmas))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(8104, 3961, 2135)</code></pre>
</div>
</div>
<p>Now let’s count tokens using the same filters. We’ll need this to calculate a lemma-to-token ratio.</p>
<div id="04f17345-0cef-4392-b014-63fceb857dfc" class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_content_tokens(docs):</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> doc <span class="kw">in</span> docs:</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tok <span class="kw">in</span> doc:</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> tok.is_alpha <span class="kw">and</span> <span class="kw">not</span> tok.is_stop:</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>                total <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>promask_token_total <span class="op">=</span> count_content_tokens(docs_promask)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>antimask_token_total <span class="op">=</span> count_content_tokens(docs_antimask)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bdc7da6f-ae9c-4b1c-bd44-537aa61439f4" class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lemma-to-token ratio (lexical variety)</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>lemma_token_ratios <span class="op">=</span> {</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"promask"</span>: <span class="bu">len</span>(promask_lemmas) <span class="op">/</span> promask_token_total,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"antimask"</span>: <span class="bu">len</span>(antimask_lemmas) <span class="op">/</span> antimask_token_total,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>lemma_token_ratios</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'promask': 0.20993187058000673, 'antimask': 0.261296919321855}</code></pre>
</div>
</div>
<p>The lemma-to-token ratio (LTR) is a way to quantify <strong>lexical variety</strong> after normalization for meaning. It answers a more precise question than raw vocabulary size.</p>
<p>Here’s we’re asking: <em>How many distinct underlying words are used per content word produced.</em></p>
<p>We calculate:</p>
<ul>
<li>Tokens as alphabetic, non-stopword tokens</li>
<li>Lemmas as tokens collapsed to their base form (mask, not masks/masking/masked)</li>
</ul>
<p>When we look at it here, it looks like antimask as a higher ratio of content words – but we can’t really say that because we have different dataset sizes for promask and antimask. We’d have to sample to compare more directly.</p>
<p>Now let’s take a look at how overlapping lemmas are.</p>
<div id="9e6f9cf7-4189-4bc0-b293-253e2e18e8e4" class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of shared vs. group-specific lemmas</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>lemma_overlap_stats <span class="op">=</span> {</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"shared_lemmas"</span>: <span class="bu">len</span>(shared_lemmas),</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"promask_unique"</span>: <span class="bu">len</span>(unique_to_promask_lemmas),</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"antimask_unique"</span>: <span class="bu">len</span>(unique_to_antimask_lemmas),</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"promask_total"</span>: <span class="bu">len</span>(promask_lemmas),</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"antimask_total"</span>: <span class="bu">len</span>(antimask_lemmas),</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>lemma_overlap_stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'shared_lemmas': 2135,
 'promask_unique': 5969,
 'antimask_unique': 1826,
 'promask_total': 8104,
 'antimask_total': 3961}</code></pre>
</div>
</div>
<div id="772e02cd-0ed8-435c-8015-68267913978b" class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize to proportions</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>lemma_overlap_ratios <span class="op">=</span> {</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"promask_shared_prop"</span>: <span class="bu">len</span>(shared_lemmas) <span class="op">/</span> <span class="bu">len</span>(promask_lemmas),</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"antimask_shared_prop"</span>: <span class="bu">len</span>(shared_lemmas) <span class="op">/</span> <span class="bu">len</span>(antimask_lemmas),</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"promask_unique_prop"</span>: <span class="bu">len</span>(unique_to_promask_lemmas) <span class="op">/</span> <span class="bu">len</span>(promask_lemmas),</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"antimask_unique_prop"</span>: <span class="bu">len</span>(unique_to_antimask_lemmas) <span class="op">/</span> <span class="bu">len</span>(antimask_lemmas),</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>lemma_overlap_ratios</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'promask_shared_prop': 0.2634501480750247,
 'antimask_shared_prop': 0.5390053016914921,
 'promask_unique_prop': 0.7365498519249754,
 'antimask_unique_prop': 0.460994698308508}</code></pre>
</div>
</div>
<p>Let’s put all of this together…</p>
<div id="abf064c6-4c7a-4d3a-a6f8-e90784f76fd1" class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>lemma_summary <span class="op">=</span> pd.DataFrame.from_dict(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"promask"</span>: {</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content_tokens"</span>: promask_token_total,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"unique_lemmas"</span>: <span class="bu">len</span>(promask_lemmas),</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"lemma_token_ratio"</span>: <span class="bu">len</span>(promask_lemmas) <span class="op">/</span> promask_token_total,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"shared_lemma_prop"</span>: <span class="bu">len</span>(shared_lemmas) <span class="op">/</span> <span class="bu">len</span>(promask_lemmas),</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"unique_lemma_prop"</span>: <span class="bu">len</span>(unique_to_promask_lemmas) <span class="op">/</span> <span class="bu">len</span>(promask_lemmas),</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"antimask"</span>: {</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content_tokens"</span>: antimask_token_total,</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"unique_lemmas"</span>: <span class="bu">len</span>(antimask_lemmas),</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"lemma_token_ratio"</span>: <span class="bu">len</span>(antimask_lemmas) <span class="op">/</span> antimask_token_total,</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"shared_lemma_prop"</span>: <span class="bu">len</span>(shared_lemmas) <span class="op">/</span> <span class="bu">len</span>(antimask_lemmas),</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"unique_lemma_prop"</span>: <span class="bu">len</span>(unique_to_antimask_lemmas) <span class="op">/</span> <span class="bu">len</span>(antimask_lemmas),</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>).T</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>lemma_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">content_tokens</th>
<th data-quarto-table-cell-role="th">unique_lemmas</th>
<th data-quarto-table-cell-role="th">lemma_token_ratio</th>
<th data-quarto-table-cell-role="th">shared_lemma_prop</th>
<th data-quarto-table-cell-role="th">unique_lemma_prop</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">promask</td>
<td>38603.0</td>
<td>8104.0</td>
<td>0.209932</td>
<td>0.263450</td>
<td>0.736550</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">antimask</td>
<td>15159.0</td>
<td>3961.0</td>
<td>0.261297</td>
<td>0.539005</td>
<td>0.460995</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>The table compares lexical variety after lemmatization between the pro-mask and anti-mask groups, controlling for stopwords and non-alphabetic tokens.</p>
<ol type="1">
<li>Corpus size vs.&nbsp;vocabulary size</li>
</ol>
<ul>
<li>Pro-mask tweets contain many more content tokens overall.</li>
<li>They also contain more unique lemmas in absolute terms.</li>
</ul>
<p>But… a larger corpus naturally accumulates more distinct words. So this is not surprising.</p>
<ol start="2" type="1">
<li>Lemma–token ratio (lexical variety) - Anti-mask has a higher lemma-to-token ratio than pro-mask.</li>
</ol>
<p>This could mean that anti-mask discourse discourse uses fewer total words, but those words are less repetitious. It seems pro-mask discourse repeats the same lemmas more often. With more effort and great attention to tokenization, you could dig deeper and derive some real insights.</p>
<p>Now let’s look at lemmas! Are we seeing themes, clusters of conversation around particular institutions, people, emotions, etc?</p>
<div id="7d2c1a50-fc59-4df5-bf74-b80c1f29c864" class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_lemma_frequencies(docs, target_lemmas<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Count lemma frequencies in spaCy Docs.</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co">    docs : iterable of spacy.tokens.Doc</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Pre-parsed spaCy documents.</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="co">    target_lemmas : set[str] or None</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="co">        If provided, only lemmas in this set are counted.</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Counter</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Mapping from lemma -&gt; frequency.</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> Counter()</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> doc <span class="kw">in</span> docs:</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tok <span class="kw">in</span> doc:</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>                tok.is_alpha</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>                <span class="kw">and</span> <span class="kw">not</span> tok.is_stop</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>            ):</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>                lemma <span class="op">=</span> tok.lemma_.lower()</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> target_lemmas <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> lemma <span class="kw">in</span> target_lemmas:</span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>                    counts[lemma] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fed0c22b-5344-4634-a2bd-9109e82d85ae" class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 20 lemmas promask</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>promask_top20 <span class="op">=</span> count_lemma_frequencies(</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    docs_promask,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    unique_to_promask_lemmas</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>).most_common(<span class="dv">20</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Top 20 Promask-unique lemmas:"</span>)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lemma, count <span class="kw">in</span> promask_top20:</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>lemma<span class="sc">:&lt;20}</span><span class="ss"> </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Top 20 Promask-unique lemmas:
stayathomesavelive   86
staysafe             74
washyourhand         71
cotton               68
morning              64
layer                49
sunday               45
stayhome             43
challenge            43
covidisreal          32
wash                 27
vma                  26
nominate             24
cont                 23
foot                 23
flower               23
gaga                 22
cool                 21
practice             21
art                  20</code></pre>
</div>
</div>
<div id="446ff145-438e-485f-b584-f19386ec1f2f" class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 20 lemmas unique antimask</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>antimask_top20 <span class="op">=</span> count_lemma_frequencies(</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    docs_antimask,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    unique_to_antimask_lemmas</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>).most_common(<span class="dv">20</span>)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 20 Antimask-unique lemmas:"</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lemma, count <span class="kw">in</span> antimask_top20:</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>lemma<span class="sc">:&lt;20}</span><span class="ss"> </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 20 Antimask-unique lemmas:
scamdemic            67
notomask             37
evid                 19
newspaper            18
bill                 16
awake                14
keepbritainfree      14
nwo                  13
quietly              12
entity               12
globalist            10
ableg                10
logical              10
cdnpoli              9
abpoli               9
legally              9
covidscam            8
standupx             8
fakepandemic         8
pcr                  8</code></pre>
</div>
</div>
<div id="4d979f0a-c19a-4654-ba00-afd42826eb23" class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count shared lemma frequencies per group</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>shared_promask <span class="op">=</span> count_lemma_frequencies(</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    docs_promask,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    target_lemmas<span class="op">=</span>shared_lemmas</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>shared_antimask <span class="op">=</span> count_lemma_frequencies(</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    docs_antimask,</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    target_lemmas<span class="op">=</span>shared_lemmas</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Build comparison table</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>shared_df <span class="op">=</span> (</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>    pd.DataFrame({</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"lemma"</span>: <span class="bu">list</span>(shared_lemmas),</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"promask_rate_per_1k"</span>: [</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>            shared_promask.get(l, <span class="dv">0</span>) <span class="op">/</span> promask_token_total <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> shared_lemmas</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"antimask_rate_per_1k"</span>: [</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>            shared_antimask.get(l, <span class="dv">0</span>) <span class="op">/</span> antimask_token_total <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> shared_lemmas</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>    .assign(max_rate<span class="op">=</span><span class="kw">lambda</span> d: d[[<span class="st">"promask_rate_per_1k"</span>, <span class="st">"antimask_rate_per_1k"</span>]].<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">"max_rate"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"max_rate"</span>)</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">20</span>)</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>shared_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">lemma</th>
<th data-quarto-table-cell-role="th">promask_rate_per_1k</th>
<th data-quarto-table-cell-role="th">antimask_rate_per_1k</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1670</td>
<td>covidhoax</td>
<td>0.025905</td>
<td>68.078369</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2016</td>
<td>wearamask</td>
<td>60.176670</td>
<td>0.329837</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2058</td>
<td>mask</td>
<td>32.717664</td>
<td>11.742199</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">259</td>
<td>wear</td>
<td>17.330259</td>
<td>4.815621</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">132</td>
<td>covid</td>
<td>5.129135</td>
<td>11.940102</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">550</td>
<td>people</td>
<td>9.532938</td>
<td>11.478330</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">192</td>
<td>amp</td>
<td>6.217133</td>
<td>6.662709</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1087</td>
<td>plandemic</td>
<td>0.051809</td>
<td>6.530774</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2124</td>
<td>test</td>
<td>1.347046</td>
<td>6.266904</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1730</td>
<td>death</td>
<td>2.098283</td>
<td>6.134969</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">694</td>
<td>face</td>
<td>6.061705</td>
<td>1.385316</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">397</td>
<td>thank</td>
<td>5.932181</td>
<td>0.923544</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1886</td>
<td>get</td>
<td>4.041137</td>
<td>5.673197</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>like</td>
<td>5.310468</td>
<td>3.760142</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1193</td>
<td>day</td>
<td>5.284563</td>
<td>2.770631</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">121</td>
<td>new</td>
<td>5.025516</td>
<td>2.704664</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">701</td>
<td>know</td>
<td>3.134471</td>
<td>4.947556</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">430</td>
<td>go</td>
<td>3.626661</td>
<td>4.815621</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1283</td>
<td>good</td>
<td>4.766469</td>
<td>2.044990</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1667</td>
<td>need</td>
<td>4.118851</td>
<td>4.617719</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Lemmatization can reduce vocabulary size while preserving meaning, which directly affects model sparsity, generalization, and interpretability. That said, it’s most useful if your focus on is on meaning such as <strong>topic modeling</strong>, <strong>keyword extraction</strong>, and <strong>search</strong>. It can also be helpful for bag-of-word ML classifiers such as logistic regression, naive bayes, and SVMs.</p>
</section>
<section id="reflection-3" class="level2">
<h2 class="anchored" data-anchor-id="reflection-3">Reflection</h2>
<ol type="1">
<li><p>Does lemmatization change your interpretation of lexical diversity compared to raw token counts?</p></li>
<li><p>Do you think lemmatization would help or hurt a stance classifier trained on this data? Why?</p></li>
<li><p>What did you find most interesting from this lab?</p></li>
<li><p>What did you find most surprising from this lab?</p></li>
</ol>
<div id="bf971078-32c1-4f05-a71d-97046517efd2" class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>q9_answer <span class="op">=</span> <span class="st">"Does lemmatization change your interpretation of lexical diversity compared to raw token counts?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ce8cde64-ea85-49f7-85d8-fa70adf84240" class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>q10_answer <span class="op">=</span> <span class="st">"Can you tell which group appears to rely more on repeated lexical items"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bc3f1274-f402-4108-9c13-5d93b12d45be" class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>q11_answer <span class="op">=</span> <span class="st">"What did you find most interesting from this lab?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="05cc9eb2-40ec-44cf-96dc-ebe76741e2fa" class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>q12_answer <span class="op">=</span> <span class="st">"What did you find most surprising from this lab?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="notebook-summary" class="level2">
<h2 class="anchored" data-anchor-id="notebook-summary">Notebook Summary</h2>
<ul>
<li><strong>Text preprocessing</strong> involves many analytic decisions. Every decision affects downstream analyses such as vocabulary, frequency counts, and analyses.</li>
<li><strong>Raw frequency</strong> is rarely informative on its own; normalization and relative measures are necessary to compare groups of different sizes meaningfully.</li>
<li><strong>Dispersion</strong> complements frequency by showing where language appears, helping distinguish widespread usage from repetition, coordination, or amplification.</li>
<li><strong>Keyword-in-context (KWIC)</strong> analysis grounds statistics in real language use, revealing how the same word can serve different functions across groups and exposing preprocessing artifacts.</li>
<li><strong>Lemmatization</strong> shifts analysis from surface form to meaning, reducing sparsity and enabling clearer comparisons of lexical variety and shared vs.&nbsp;group-specific vocabulary.</li>
<li><strong>Lexical variety metrics</strong> (e.g., lemma-to-token ratio) reveal differences in repetition and semantic breadth that are not visible in raw counts.</li>
</ul>
<p>Multiple perspectives are essential: meaningful text analysis emerges from combining frequency, normalization, dispersion, and contextual inspection rather than relying on any single metric.</p>
<div id="d167ea0e-f258-49e4-a02e-2a17c5a46125" class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># REVIEW ONLY — does not submit</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> data401_nlp.helpers.submit <span class="im">import</span> collect_answers, parse_answers, submit_answers</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co"># REVIEW ONLY — does not submit</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>raw <span class="op">=</span> collect_answers(</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    show<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    namespace<span class="op">=</span><span class="bu">globals</span>(),  </span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>answers <span class="op">=</span> parse_answers(raw)</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Detected </span><span class="sc">{</span><span class="bu">len</span>(answers)<span class="sc">}</span><span class="ss"> answers:"</span>)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> answers:</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" "</span>, k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Student Responses (from variable state) ===

q12_answer = 'What did you find most surprising from this lab?'

Detected 1 answers:
  q12_answer</code></pre>
</div>
</div>
<div id="e4598458-a89b-4a81-97ab-3216ac3e4746" class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>ALLOW_SUBMISSION <span class="op">=</span> <span class="va">False</span>   <span class="co"># ← student MUST change this</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> submit_for_credit(student_id):</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> ALLOW_SUBMISSION:</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">RuntimeError</span>(</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"⚠️ Submission is disabled.</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"To submit:</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"  1. Set ALLOW_SUBMISSION = True</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"  2. Re-run this cell"</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>    submit_answers(</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>        student_id<span class="op">=</span>student_id,</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>        answers<span class="op">=</span>answers,   <span class="co"># uses reviewed answers</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"✅ Submission complete."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="261c50b8-a7c8-4f08-8b95-49e335864725" class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ✏️ EDIT WITH YOUR STUDENT ID</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>submit_for_credit(<span class="st">"test_student"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>RuntimeError: ⚠️ Submission is disabled.

To submit:
  1. Set ALLOW_SUBMISSION = True
  2. Re-run this cell</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/su-dataAI/data401-nlp/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>